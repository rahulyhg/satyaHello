<?php 
$session=new Zend\Session\Container('admin');
// print_r($_SESSION['admin']);die;
if($session->offsetGet('adminuser')==''){
	$bashPath=$this->basePath();
	$location="Location:".$bashPath."/admin";
 	header($location);	
	exit;	
 } ?><style>
.loader2{position:fixed;
top:250;
background:none;
z-index:1000000;
margin:auto;
margin-left:40%;}
</style>
<img src="http://hello42cab.com/public/image/loading.gif" class="loader2" width="150" height="150">
<style>
.table{
margin-bottom:0px;
}
#map {
height: 300px;
margin-top:5px;

}
 
 
 input:not([type=checkbox]), textarea {
 padding: 5px;
 border: 1px solid #ccc;
 -moz-border-radius: 5px;
 -webkit-border-radius: 5px;
}
.formGenbill {
  width: 500px;
  margin: 0 auto;
  margin-bottom:20px;
}
.formGenbill fieldset {
  padding: 5px 26px;
  border: 1px dotted #858585;
  -moz-border-radius: 10px;
  -webkit-border-radius: 10px;
}
.formGenbill legend {
  padding: 5px 20px 5px 20px;
  color: #030303;
  -moz-border-radius: 6px;
  -webkit-border-radius: 6px;
  background:none;
  font-weight:bold;
  font-size:15px;
}
.formGenbill ol {
  list-style: none;
  margin-bottom: 20px;
  border: 1px solid #b4b4b4;
  -moz-border-radius: 10px;
  -webkit-border-radius: 10px;
  padding: 10px;
}
.formGenbill ol, .formGenbill legend, .formGenbill fieldset {
/*background-image: -moz-linear-gradient(top, #f7f7f7, #e5e5e5); /* FF3.6 
  background-image: -webkit-gradient(linear,left bottom,left top,color-stop(0, #e5e5e5),color-stop(1, #f7f7f7));*/ /* Saf4+, Chrome */
}
.formGenbill ol.buttons {
  overflow: auto;
}
.formGenbill ol li label {
  float: left;
  width: 160px;
  font-weight: bold;
}

.settings {
  /* width: 400px; */
  list-style: none;
  position: relative;
}

.settings ul {
  list-style:none;
  margin:0;
  padding:0;
}
.settings ul li {
  display:inline-block;
  width:45%;
  text-align:left;
  margin-bottom:5px;
  line-height:20px;
}
.settings ul li span.fright {
  float:right;
  font-weight:bold;
}
.settings textarea { vertical-align:top; text-align:left!important; font-size:12px!important;}


.close {
    color: #000;
    float: right;
    font-size: 21px;
    font-weight: 700;
    line-height: 1;
    opacity: 0.2;
    text-shadow: 0 1px 0 #fff;
}
.close:focus, .close:hover {
    color: #000;
    cursor: pointer;
    opacity: 0.5;
    text-decoration: none;
}
button.close {
    background: rgba(0, 0, 0, 0) none repeat scroll 0 0;
    border: 0 none;
    cursor: pointer;
    padding: 0;
}
 

</style>
  
    <div id="page-wrapper">
        <h4><b class="booking_header"></b></h4>
                    <div>
                        <div class="portlet portlet-default">
                           <div class="portlet-heading">
                                <div class=" ">
                                 
                                    <i class="fa fa-filter" style="float: left;margin:7px;color:#3D84C1;"></i>
									<h6 style="background:#E2E2E2;padding:7px; margin:0;" color="#3f89c9 !important;" class="filter"></h6>
                                
                                <div class="clearfix"></div>
                            </div>
                                <div class="clearfix"></div>
                            </div>
                            <div class="portlet-body">
                                <ul id="myTab" class="nav nav-tabs">
                                    <li class="active">
                                        <a href="#home" data-toggle="tab"><i class="fa fa-list" style="color:#; margin:5px"></i><span id="general_fiter_head" class="general_filter_head"></span></a>
                                    </li>
                                    <li>
                                        <a href="#client_tab" data-toggle="tab" id="new_ClientTab"><i class="fa fa-user" style="color:#; margin:5px"></i><span class="client_filter_head"></span></a>
                                    </li>
                                    <li>
                                        <a href="#driver_tab" id="myTabDrop1" class="dropdown-toggle" data-toggle="tab"><i class="fa fa-user" style="color:#; margin:5px"></i><span class="driver_filter_head"></span></a>
                                     </li>
                                    <li>
                                        <a href="#vehicle_tab" id="myTabDrop2" class="dropdown-toggle" data-toggle="tab"><i class="fa fa-road" style="color:#; margin:5px"></i><span class="vehicle_filter_head"></span></a>
                                     </li>
                                    <li>
                                        <a href="#location_tab" id="myTabDrop3" class="dropdown-toggle" data-toggle="tab"><i class="fa fa-globe" style="color:#; margin:5px"></i><span class="location_filter_head"></span></a>
                                     </li>
                                    <li>
                                        <a href="#state_tab" id="myTabDrop4" class="dropdown-toggle" data-toggle="tab"><i class="fa fa-gear (alias)" style="color:#; margin:5px"></i><span class="state_filter_head"></span></a>
                                     </li>
                                    <li>
                                        <a href="#payment_tab" id="myTabDrop5" class="dropdown-toggle" data-toggle="tab"><i class="fa fa-eur" style="color:#; margin:5px"></i><span class="payment_filter_head"></span></a>
                                     </li>
                                </ul>
                                <form id="bookingFilter">
                                <div id="myTabContent" class="tab-content">
                                    <div class="tab-pane fade in active" id="home">
                                        <div class="container col-sm-col-sm-offset-1" style="margin: 10px auto 0px !important;padding: 0 10px;">
										<div class="row">
                                                <div class="form-group clearfix margintopbottom20">
												   <label id="flight_nos" class="col-sm-2 control-label labelalign booking_id_filter"></label>
                                                  <div class="col-sm-4">
                                                     <input id="ref" type="text" class=" form-control inputchange" placeholder="Booking Process Id">                                    
                                                  </div>
                                                 
 												    <label id="point_airport" class="col-sm-2 control-label labelalign vehicle_owner_filter"></label>
                                                   <div class="col-sm-4">
                                                         <input id="vehicle_owner" type="text" class=" form-control inputchange" placeholder="Vehicle Owner">     
                                                    </div>
                                                 </div>
                                             </div>
											 
											 <div class="row">
                                                <div class="form-group clearfix margintopbottom20">
												   <label id="flight_nos" class="col-sm-2 control-label labelalign booking_type_filter"></label>
                                                  <div class="col-sm-4">
												  
                                                     <input id="type" type="text" class=" form-control inputchange" placeholder="Booking Type">                                    
                                                  </div>
                                                 
 												    <label id="point_airport" class="col-sm-2 control-label labelalign driver_filter"></label>
                                                   <div class="col-sm-4">
                                                        <div class="input-group">
 													<input id="driver_name" type="text" class="form-control inputchange" placeholder="Driver">
													<span class="input-group-addon"><i class="fa fa-search"></i></span>   
                                                </div> 
                                                    </div>
                                                 </div>
                                             </div>
											  <div class="row">
                                                <div class="form-group clearfix margintopbottom20">
												   <label id="flight_nos" class="col-sm-2 control-label labelalign">Initial request data</label>
                                                  <div class="col-sm-2">
                                                     <input id="created_since" type="text" class=" form-control inputchange" placeholder="Since">                                    
                                                  </div>
												   <div class="col-sm-2">
                                                     <input id="created_to" type="text" class=" form-control inputchange" placeholder="To">                                    
                                                  </div>
                                                 
 												    <label id="point_airport" class="col-sm-2 control-label labelalign">Partner</label>
                                                   <div class="col-sm-4">
												     <div class="input-group">
 													<input type="text" id="partner" class="form-control inputchange" placeholder="Partner">
													<span class="input-group-addon"><i class="fa fa-search"></i></span>   
                                                </div> 
                                                            
                                                    </div>
                                                 </div>
                                             </div>
                                            
                                            
                                            
                                            
                                            
                                            <div class="row">
                                                <div class="form-group clearfix margintopbottom20">
												   <label id="flight_nos" class="col-sm-2 control-label labelalign ">Booking Status</label>
                                                  <div class="col-sm-4">
                                                     <select name="booking_status" id="select" style="" class="col-sm-12 col-lg-12 inputfild name valid" aria-required="true" aria-invalid="false"></select>
                                                  </div>
												   
                                                 
 												    
                                                  
                                                 </div>
                                             </div>
                                            
                                            
                                            
                                            
                                            
                                            
                                            
                                            
                                            
                                            
                                            
                                            
											   <div class="row">
                                                <div class="form-group clearfix margintopbottom20">
												 
                                                  <div class="col-sm-4 pull-right">
                                                     <a href="#" class="btn btn-red defaultbtnsearch searchBooking"><i class="fa fa-search" id="search_me" style="color:#fff; margin:5px"></i>Search</a>
						<a href="javascript:document.getElementById('bookingFilter').reset();" class="btn btn-red defaultbtnsearch"><i class="fa fa-times" style="color:#fff; margin:5px"></i>Clear</a>                                  
                                                  </div>
												  
												   
                                                 
 												    
                                                  
                                                 </div>
                                             </div>
											 
											 
											 
											 
										</div>
                                    </div>
                                    <div class="tab-pane fade" id="client_tab">
                                       <div class="container col-sm-col-sm-offset-1" style="margin: 10px auto 0px !important;padding: 0 10px;">
										<div class="row">
                                                <div class="form-group clearfix margintopbottom20">
												   <label id="flight_nos" class="col-sm-2 control-label labelalign ">Client first Name</label>
                                                  <div class="col-sm-4">
                                                     <input id="client_first_name" type="text" class=" form-control inputchange" placeholder="Client first Name">                                    
                                                  </div>
                                                 
 												    <label id="point_airport" class="col-sm-2 control-label labelalign ">Client rating</label>
                                                   <div class="col-sm-4">
                                                         <select name="client_rating" id="client_rating" style="" class="col-sm-12 col-lg-12 inputfild name valid" aria-required="true" aria-invalid="false"></select>
                                                    </div>
                                                 </div>
                                             </div>
											 
											 <div class="row">
                                                <div class="form-group clearfix margintopbottom20">
												   <label id="flight_nos" class="col-sm-2 control-label labelalign ">Client Last Name</label>
                                                  <div class="col-sm-4">
												  
                                                     <input id="client_last_name" type="text" class=" form-control inputchange" placeholder="Client Last Name">                                    
                                                  </div>
                                                 
 												    <label id="point_airport" class="col-sm-2 control-label labelalign ">Mobile No</label>
                                                   <div class="col-sm-4">
                                                        <div class="input-group">
                                                <input id="client_mob" type="text" class="form-control inputchange" placeholder="Mobile No">
                                                <span class="input-group-addon"><i class="fa fa-search"></i></span>   
                                                </div> 
                                                    </div>
                                                 </div>
                                             </div>
											  <div class="row">
                                                <div class="form-group clearfix margintopbottom20">
												   <label id="flight_nos" class="col-sm-2 control-label labelalign">Client Id</label>
                                                  <div class="col-sm-4">
                                                     <input id="client_ids" type="text" class=" form-control inputchange" placeholder="Client Id">                                    
                                                  </div>
												   
                                                 
 												    <label id="point_airport" class="col-sm-2 control-label labelalign">Client Email</label>
                                                   <div class="col-sm-4">
												     <div class="input-group">
 													<input type="text" id="client_email" class="form-control inputchange" placeholder="Client Email">
													<span class="input-group-addon"><i class="fa fa-search"></i></span>   
                                                </div> 
                                                            
                                                    </div>
                                                 </div>
                                             </div>
											   <div class="row">
                                                <div class="form-group clearfix margintopbottom20">
												 
                                                  <div class="col-sm-4 pull-right">
                                                     <a href="#" class="btn btn-red defaultbtnsearch searchBooking"><i class="fa fa-search" id="search_me" style="color:#fff; margin:5px"></i>Search</a>
						<a href="javascript:document.getElementById('bookingFilter').reset();" class="btn btn-red defaultbtnsearch"><i class="fa fa-times" style="color:#fff; margin:5px"></i>Clear</a>                                  
                                                  </div>
												  
												   
                                                 
 												    
                                                  
                                                 </div>
                                             </div>
											 
											 
											 
											 
										</div>  
                                    </div>
                                    <div class="tab-pane fade" id="driver_tab">
                                         <div class="container col-sm-col-sm-offset-1" style="margin: 10px auto 0px !important;padding: 0 10px;">
										<div class="row">
                                                <div class="form-group clearfix margintopbottom20">
												   <label id="flight_nos" class="col-sm-2 control-label labelalign ">Driver First Name</label>
                                                  <div class="col-sm-4">
                                                     <input id="driver_first_name" type="text" class=" form-control inputchange" placeholder="Driver First Name">                                    
                                                  </div>
                                                 
 												    <label id="point_airport" class="col-sm-2 control-label labelalign ">Driver Rating</label>
                                                   <div class="col-sm-4">
                                                         <select name="driver_rating" id="driver_rating" style="" class="col-sm-12 col-lg-12 inputfild name valid" aria-required="true" aria-invalid="false"></select>
                                                    </div>
                                                 </div>
                                             </div>
											 
											 <div class="row">
                                                <div class="form-group clearfix margintopbottom20">
												   <label id="flight_nos" class="col-sm-2 control-label labelalign ">Driver Last name</label>
                                                  <div class="col-sm-4">
												  
                                                     <input id="driver_last_name" type="text" class=" form-control inputchange" placeholder="Driver Last name">                                    
                                                  </div>
                                                 
 												    <label id="point_airport" class="col-sm-2 control-label labelalign ">Driver Email</label>
                                                   <div class="col-sm-4">
                                                        <div class="input-group">
 													<input id="driver_email" type="text" class="form-control inputchange" placeholder="Driver Email">
													<span class="input-group-addon"><i class="fa fa-search"></i></span>   
                                                </div> 
                                                    </div>
                                                 </div>
                                             </div>
											  <div class="row">
                                                <div class="form-group clearfix margintopbottom20">
												   <label id="flight_nos" class="col-sm-2 control-label labelalign">Driver Id</label>
                                                  <div class="col-sm-4">
                                                     <input id="driver_ids" type="text" class=" form-control inputchange" placeholder="Driver Id">                                    
                                                  </div>
												   
                                                 
 												    <label id="point_airport" class="col-sm-2 control-label labelalign">Driver mobile No</label>
                                                   <div class="col-sm-4">
												     <div class="input-group">
 													<input type="text" id="driver_mob" class="form-control inputchange" placeholder="Driver mobile No">
													<span class="input-group-addon"><i class="fa fa-search"></i></span>   
                                                </div> 
                                                           
                                                    </div>
                                                 </div>
                                                                                              <div class="form-group clearfix margintopbottom20">
 												    <label id="point_airport" class="col-sm-2 control-label labelalign ">External Reference</label>
                                                   <div class="col-sm-4">
                                                         <input id="driver_ext_ref" type="text" class=" form-control inputchange" placeholder="External Reference">     
                                                    </div>
                                                 </div>
                                             </div>
											   <div class="row">
                                                <div class="form-group clearfix margintopbottom20">
												 
                                                  <div class="col-sm-4 pull-right">
                                                     <a href="#" class="btn btn-red defaultbtnsearch searchBooking"><i class="fa fa-search" id="search_me" style="color:#fff; margin:5px"></i>Search</a>
						<a href="javascript:document.getElementById('bookingFilter').reset();" class="btn btn-red defaultbtnsearch"><i class="fa fa-times" style="color:#fff; margin:5px"></i>Clear</a>                                  
                                                  </div>
												  
												   
                                                 
 												    
                                                  
                                                 </div>
                                             </div>
											 
											 
											 
											 
										</div>
                                    </div>
                                    <div class="tab-pane fade" id="vehicle_tab">
                                       <div class="container col-sm-col-sm-offset-1" style="margin: 10px auto 0px !important;padding: 0 10px;">
										<div class="row">
                                                <div class="form-group clearfix margintopbottom20">
												   <label id="flight_nos" class="col-sm-2 control-label labelalign ">Vehicle Type</label>
                                                  <div class="col-sm-4">
                                                     <select name="vehicle_type" id="vehicle_type" style="" class="col-sm-12 col-lg-12 inputfild name valid" aria-required="true" aria-invalid="false"></select>
                                                  </div>
                                                 
 												    <label id="point_airport" class="col-sm-2 control-label labelalign ">License Plate</label>
                                                   <div class="col-sm-4">
                                                         <input id="license_plate" type="text" class=" form-control inputchange" placeholder="License Plate">     
                                                    </div>
                                                 </div>
                                             </div>
											 
											 <div class="row">
                                                <div class="form-group clearfix margintopbottom20">
												   <label id="flight_nos" class="col-sm-2 control-label labelalign ">External Reference</label>
                                                  <div class="col-sm-4">
												  
                                                     <input id="veh_ext_ref" type="text" class=" form-control inputchange" placeholder="External Reference">                                    
                                                  </div>
                                                 
 												    
                                                 </div>
                                             </div>
											
											   <div class="row">
                                                <div class="form-group clearfix margintopbottom20">
												 
                                                  <div class="col-sm-4 pull-right">
                                                     <a href="#" class="btn btn-red defaultbtnsearch searchBooking"><i class="fa fa-search" id="search_me" style="color:#fff; margin:5px"></i>Search</a>
						<a href="javascript:document.getElementById('bookingFilter').reset();" class="btn btn-red defaultbtnsearch"><i class="fa fa-times" style="color:#fff; margin:5px"></i>Clear</a>                                  
                                                  </div>
												  
												   
                                                 
 												    
                                                  
                                                 </div>
                                             </div>
											 
											 
											 
											 
										</div>
                                    </div>
                                    <div class="tab-pane fade" id="location_tab">
                                       <div class="container col-sm-col-sm-offset-1" style="margin: 10px auto 0px !important;padding: 0 10px;">
										<div class="row">
                                                <div class="form-group clearfix margintopbottom20">
												   <label id="flight_nos" class="col-sm-2 control-label labelalign ">Country</label>
                                                  <div class="col-sm-4">
                                                     <input id="country" type="text" class=" form-control inputchange" placeholder="Country">                                    
                                                  </div>
                                                 
 												    <label id="point_airport" class="col-sm-2 control-label labelalign ">Pickup</label>
                                                   <div class="col-sm-4">
                                                         <input id=" " type="pickups" class=" form-control inputchange" placeholder="Pickup">     
                                                    </div>
                                                 </div>
                                             </div>
											 
											 <div class="row">
                                                <div class="form-group clearfix margintopbottom20">
												   <label id="flight_nos" class="col-sm-2 control-label labelalign ">City</label>
                                                  <div class="col-sm-4">
												  
                                                     <input id="city" type="text" class=" form-control inputchange" placeholder="City">                                    
                                                  </div>
                                                 
 												    <label id="point_airport" class="col-sm-2 control-label labelalign ">Drop Off</label>
                                                   <div class="col-sm-4">
                                                        <div class="input-group">
 													<input id="drop_off" type="text" class="form-control inputchange" placeholder="Drop Off">
													<span class="input-group-addon"><i class="fa fa-search"></i></span>   
                                                </div> 
                                                    </div>
                                                 </div>
                                             </div>
										
											   <div class="row">
                                                <div class="form-group clearfix margintopbottom20">
												 
                                                  <div class="col-sm-4 pull-right">
                                                     <a href="#" class="btn btn-red defaultbtnsearch searchBooking"><i class="fa fa-search" id="search_me" style="color:#fff; margin:5px"></i>Search</a>
						<a href="javascript:document.getElementById('bookingFilter').reset();" class="btn btn-red defaultbtnsearch"><i class="fa fa-times" style="color:#fff; margin:5px"></i>Clear</a>                                  
                                                  </div>
												  
												   
                                                 
 												    
                                                  
                                                 </div>
                                             </div>
											 
											 
											 
											 
										</div>
                                    </div>
                                     <div class="tab-pane fade" id="state_tab">
                                       <div class="container col-sm-col-sm-offset-1" style="margin: 10px auto 0px !important;padding: 0 10px;">
										<div class="row">
                                                <div class="form-group clearfix margintopbottom20">
												   <label id="flight_nos" class="col-sm-2 control-label labelalign ">Booking Status</label>
                                                  <div class="col-sm-4">
                                                     <select name="booking_status" id="booking_status" style="" class="col-sm-12 col-lg-12 inputfild name valid" aria-required="true" aria-invalid="false" style="font-size:12px !important;"></select>
                                                  </div>
                                                 
 												    <label id="point_airport" class="col-sm-2 control-label labelalign ">Order Time</label>
                                                   <div class="col-sm-4">
                                                         <select name="order_time" id="order_time" style="" class="col-sm-12 col-lg-12 inputfild name valid" aria-required="true" aria-invalid="false"></select>
                                                    </div>
                                                 </div>
                                             </div>
											 
										
							
											   <div class="row">
                                                <div class="form-group clearfix margintopbottom20">
												 
                                                  <div class="col-sm-4 pull-right">
                                                     <a href="#" class="btn btn-red defaultbtnsearch searchBooking"><i class="fa fa-search" id="search_me" style="color:#fff; margin:5px"></i>Search</a>
						<a href="javascript:document.getElementById('bookingFilter').reset();" class="btn btn-red defaultbtnsearch"><i class="fa fa-times" style="color:#fff; margin:5px"></i>Clear</a>                                  
                                                  </div>
												  
												   
                                                 
 												    
                                                  
                                                 </div>
                                             </div>
											 
											 
											 
											 
										</div>
                                    </div>
                                     <div class="tab-pane fade" id="payment_tab">
                                       <div class="container col-sm-col-sm-offset-1" style="margin: 10px auto 0px !important;padding: 0 10px;">
										<div class="row">
                                                <div class="form-group clearfix margintopbottom20">
												   <label id="flight_nos" class="col-sm-2 control-label labelalign ">Payment Type</label>
                                                  <div class="col-sm-4">
                                                     <select name="payment_types" id="payment_types" style="" class="col-sm-12 col-lg-12 inputfild name valid" aria-required="true" aria-invalid="false"></select>
                                                  </div>
                                                 
 												    <label id="point_airport" class="col-sm-2 control-label labelalign ">Is paid</label>
                                                   <div class="col-sm-4">
                                                         <select name="is_paids" id="is_paids" style="" class="col-sm-12 col-lg-12 inputfild name valid" aria-required="true" aria-invalid="false"></select>
                                                    </div>
                                                 </div>
                                             </div>
											 
											 
								
											   <div class="row">
                                                <div class="form-group clearfix margintopbottom20">
												 
                                                  <div class="col-sm-4 pull-right">
                                                     <a href="#" class="btn btn-red defaultbtnsearch searchBooking"><i class="fa fa-search" id="search_me" style="color:#fff; margin:5px"></i>Search</a>
						<a href="javascript:document.getElementById('bookingFilter').reset();" class="btn btn-red defaultbtnsearch"><i class="fa fa-times" style="color:#fff; margin:5px"></i>Clear</a>                                  
                                                  </div>
												  
												   
                                                 
 												    
                                                  
                                                 </div>
                                             </div>
											 
											 
											 
											 
										</div>
                                    </div>
                                </div></form>
                            </div>
                            <!-- /.portlet-body -->
                        </div>
                        <!-- /.portlet -->
                    </div>
                    <!-- /.col-lg-12 -->
                			
					
	
<!--Details should come date wise.Hour wise.-->
	 <div class="row" style="display:;">
             
                <div class="">
                    <div class="">
                        
                        <!-- /.panel-heading -->
                        <div class="panel-body" style="padding:0 15px 15px">
                             <a href="<?php echo $this->basePath();?>/admin/dashboard/booking" class="btn btn-red defaultbtnsearch searchBooking"><i class="fa fa-refresh" id="search_me" style="color:#fff; margin:5px"></i>Refresh</a>
                            <div class="table-responsive" style="overflow-x:auto;border: 1px solid #d2d2d2; margin-top:10px;">
						 
                                <table class="table table-striped table-bordered table-hover dataTable tabcolspac font12px" style="margin-top: 0px !important;" id="dataTables-example dayWise">
                                 
                                    <body>
                                        <tr>
  					
                                            
                                            <td class="date activecol" data="<?php echo date("Y-m-d"); ?>" id="<?php echo date("Y-m-d"); ?>"><h4><?php echo date('j-M');?></h4></td>
                                            <?php 
                                            for($i=1;$i<=14;$i++)
                                            {
                                           ?>
                                            <td class="date" data="<?php echo date('Y-m-d',strtotime( date('Y-m-d')."+ $i days")); ?>" id="<?php echo date('Y-m-d',strtotime( date('Y-m-d')."+ $i days")); ?>"><h4><?php echo date('j-M',strtotime( date('Y-m-d')."+ $i days")).'</h4> &nbsp;<span></span></td>'; }?>
                                                    
                                        
                                        </tr>
                                </table>
                                 <table class="table table-striped table-bordered table-hover dataTable tabcolspac font12px" id="dataTables-example">
										 <tr>
                                                                                     
                                                                                     <td class="activecol hour" id="hour_0" data="0"><h4>0</h4><span></span></td>
							                             <?php
                                                                                     for($i=1;$i<=23;$i++)
                                                                                     {
                                                                                         
                                                                                         echo '<td id="hour_'.$i.'" class="hour" data="'.$i.'"><h4>'.$i.'</h4><span></span></td>';
                                                                                         
                                                                                     }
                                                                                     
                                                                                     ?>
                                                                                       
                                                                                        
                                        </tr> 
										
 
                                    </tbody>
                                </table>
								
 									<div class="row divspace" style="margin:0px 0; background:#f5f5f5;border: 1px solid #d1d1d1;">

                                                                            <div class="col-lg-3 book_type book_101 border-right" data='book_101' ><h5>Local Hire <img src="http://hello42cab.com/public/image/local.png"></h5><span id="span_101"></span></div>								 
  											<div class="col-lg-3 book_type book_102 border-right" data='book_102'><h5>Point To Point<img src="http://hello42cab.com/public/image/point.png" style="margin-left:5px;"></h5><span id="span_102"></span></div>
                                            <div class="col-lg-3 book_type book_103 border-right" data='book_103' ><h5>Airport<img src="http://hello42cab.com/public/image/airport.png" style="margin-left:5px;"></h5><span id="span_103"></span></div>
                                            <div class="col-lg-3 book_type book_104 border-right" data='book_104' ><h5>Outstation<img src="http://hello42cab.com/public/image/outstation.png" style="margin-left:5px;"></h5><span id="span_104"></span></div>

											
                                    </div>
                                        
							
 
                            </div>
                            <!-- /.table-responsive -->
                         
                        </div>
                        <!-- /.panel-body -->
                    </div>
                    <!-- /.panel -->
                </div>
                <!-- /.col-lg-12 -->
            </div>
	<!--Details should come date wise.Hour wise. End-->
				
         
            
            <table id="example" class="table table-striped table-responsive">
                <thead>
					<tr>
					<th>Id</th>
					<th style="width:100px !important;">Pickup Time</th>
					<th style="width:80px !important;">Vehicle</th>
					<th style="width:110px !important;">Booking Type</th>
					<th style="width:80px !important;">Partner</th>
					<th style="width:80px !important;">Client</th>
					<th  style="width:80px !important;">Departure</th>
					<th style="width:80px !important;">Drop Area</th>
					<th style="width:80px !important;" >Status</th>
					<th style="width:80px !important;">C Share</th>
					<th style="width:80px !important;">D Share</th>
					<th style="width:80px !important;">P Share</th>
					<th ></th>
					</tr>
                </thead>
                <tbody>
                </tbody>
                <tfoot>
				<tr>
				<th></th>
				<th></th>
				<th></th>
				<th></th>
				<th></th>
				</tr>
				</tfoot>
            </table>
           
         
    </div>
</div>
		<div class="col-sm-12 marginbottom20">
                
				<!--<a href="#" class="btn btn-primary marginright" id="delete_drivers_data"><i class="fa fa-envelope-o marginright"></i>Send SMS</a>-->
				<a href="#" class="btn btn-default marginright export" style="margin-left: 10px;"><i class="fa fa-download marginright"></i>Download CSV</a>
				<!--<a href="#" class="btn btn-default marginright" onclick="signupDriver();"><i class="fa fa-user marginright"></i>Add Driver</a>
				<a href="#" class="btn marginright defaultbtnsearch" ><i class="fa fa-trash-o marginright"></i>Delete</a>-->
				
				
				
				
        </div>
<!--popups Start-->
<div class="col-sm-4" id="booking_action" style=" display:none;background: rgb(255, 255, 255);padding: 20px; border-radius: 10px;">
<!--padding: 20px; border-radius: 10px;left: 16% !important; right: 16% !important; background: rgb(255, 255, 255);-->
		<form id="myform">
		<h1 class="fa fa-times closbtn b-close"></h1><h5 style="margin: 0 0 15px;"><large>Booking</large>&nbsp;<b class="booking_no">1580530343</b></h5>
        <div class="col-sm-12">
		
			<ul id="userTab" class="nav nav-tabs">
				<li class="active"><a href="#options" id="distanceVehiclep" data-toggle="tab">Options</a></li>
				<li class=""><a href="#statewrp" id="HourVehiclep" data-toggle="tab">State</a></li>
				<li class=""><a href="#financialwrp" id="" data-toggle="tab">Financial</a></li>
				<li class="dropdown">
                    <a href="#" class="dropdown-toggle" data-toggle="dropdown">Client<span class="caret"></span></a>
                    <ul class="dropdown-menu" role="menu">
                      <li><a href="#" data-toggle="tab">Liks</a></li>
                      <li><a href="#" class="client_profile" class="client_profile" target="_blank">Profile</a></li>
					  <li><a href="#"  class="client_profile" target="_blank">Booking history</a></li>
                      <li><a href="#" data-toggle="tab">Actions</a></li>
                      <li><a href="#" data-toggle="tab">Send SMS to client</a></li>
                      <li><a href="#" data-toggle="tab">Block</a></li>
                    </ul>
                </li>
				<li class="dropdown">
                    <a href="#" class="dropdown-toggle" data-toggle="dropdown">Driver<span class="caret"></span></a>
                    <ul class="dropdown-menu" role="menu">
                       <li><a href="#" data-toggle="tab">Links</a></li>
                      <li><a href="#" class="driver_profile" target="_blank">Profile</a></li>
					  <li><a href="#" class="driver_profile" target="_blank">Group</a></li>
                      <li><a href="#" data-toggle="tab">Vehicle</a></li>
                      <li><a href="#" data-toggle="tab">Booking history</a></li>
                      <li><a href="#" data-toggle="tab">Allocation history</a></li>
					  <li>&nbsp;</li>
					   <li><small style="margin-left:15px; color:#a0a0a0 !important;">Actions</small></li>
					    <li><a href="#" data-toggle="tab">Send SMS to driver</a></li>
                    </ul>
                </li>
				
			</ul>
            <div id="userTabContent" class="tab-content">
						
			 	<!--options box Start-->
						
							<div class="tab-pane fade active in" id="options">
                                <div class="row border" style="margin: -1px 0;">
                                    <div class="col-sm-12 col-md-12">
										<div class="portlet-body" style="margin:0 5px;">
                                          
                                           	<div class="form-group clearfix">
 
											<div class="col-sm-8">
                                                <h5>Actions	</h5>
													<button class="btn btn-default col-sm-9"  id="change_picktime"  onclick="$('#showchngtymbox').fadeToggle()">Change pickup time</button>
													
													
                                            </div>
											<div class="col-sm-4">
													<h5>Links</h5>
													<a href="#">Track and trace</a>
											</div>
                                            </div>
											<div class="form-group clearfix">
 
											<div class="col-sm-12">
                          <input disabled type="text" style="" id="datetimepicker" class="col-sm-6">

                          <div class="col-sm-12">
													<input type="hidden" id="reschddata">
                           <div id="showchngtymbox" style="display:none;">
                           		<div class="col-sm-12" style="margin:5px 0;">
                              <input type="text" id="datetime" data-format="DD-MM-YYYY HH:mm:ss" data-template="DD / MM / YYYY     HH : mm :ss" name="datetime" value="" onchange="setreschdtime($(this).val())">
                              </div>
                              <button id="change" class="btn btn-default col-sm-6">Save</button>


                          </div>
                          </div>
                                            </div>
												
							               </div>
											<div class="form-group clearfix">
 
											<div class="col-sm-6">
													<button class="btn btn-default col-sm-12" onclick="$('#ratebox').toggle();">Change rating
                          </button>
                      </div>
												<div class="col-sm-6" id="ratebox" style="display:none;">
                           <fieldset class="rating">
    <legend>Please rate:</legend>
                          <?php 

                            for ($i=5; $i>0  ; $i--) { 
                              # code...
                            

                          ?>

                          
    <input type="radio" id="star<?=$i?>" onclick="drvrrate($('#reschddata').text(),$(this).val(),'<?=$this->serverurl().$this->basepath().'/tunnel/menu/UserRatingfrmbackend';?>',drvrrateresults,'<?php echo $_SESSION['admin']['id'];?>')" name="rating" value="<?=$i?>" /><label for="star<?=$i?>" title="Rocks!">5 stars</label>
     

                           
													 <?php 
                          }
                           ?>
                           </fieldset>
												</div>
							               </div>
				                       </div> 
				                    </div>
								</div>
				             </div>
				<!--options box End-->
				
				<!--state box Start-->
						
							<div class="tab-pane fade in" id="statewrp">
                                <div class="row border" style="margin: -1px 0;">
                                    <div class="col-sm-12 col-md-12">
										<div class="portlet-body" style="margin:0 5px;">
                                          
                                           	<div class="form-group clearfix">
 
											<div class="col-sm-6">
                                                <h5>Actions	</h5>
													<button class="btn btn-default col-sm-12" onclick="$('#noshowbox').fadeToggle();">Execute cancel</button>
                                            </div>
                                            
                                             <div class="col-sm-6" id="noshowbox" style="display:none; float:right" align="right">
                            
    										<h5 style="float:left;">Specify Reason:<h5>
    
             <div class="col-sm-9">           
    
    <select class="form-control" name="ExeReason" id="ExeReason" onchange="Exereason($(this).val())">
      <option value="0">Select Reason</option>
      <option value="Getting Late">Getting Late</option>
      <option value="Client cancel">Client cancel</option>
      <option value="Break down">Break down</option>
      <option value="Wrong Address">Wrong Address</option>
      <option value="other">other</option>
    </select>
    </div>
    
    <div class="col-sm-3">
    <input type="submit" id="ExeSubmit" name="submit" value="Save" onclick="ExecuteCancel($('#reschddata').text(),$('#ExeReason').val(),$('#otherreason').val(),this.id,'<?=$this->serverurl().$this->basepath().'/tunnel/CustomerCare/CancelCabbkngfrmbackend';?>',ExecuteCancelresults,'<?php echo $_SESSION['admin']['id'];?>')">
    </div>
    <div class="col-sm-9" style="margin-top:5px;">
    
    <input type="text" class="form-control" placeholder="Please Specify Other" name="otherreason" id="otherreason" style="display:none;" value="" onkeyup="shoattr($(this).val())">
    
         </div>                     
                        </div>
											<!--<div class="col-sm-6">
													<h5>Links</h5>
													<a href="#"></a>
											</div>-->
                                            </div>
											
											<div class="form-group clearfix">
 
											<div class="col-sm-6">
													<button class="btn btn-default col-sm-12"   onclick="ExeNoShow($('#reschddata').text(),'<?=$this->serverurl().$this->basepath().'/tunnel/BookingCabFare/ExecuteNoShow';?>',ExeNoShowresults,'<?php echo $_SESSION['admin']['id'];?>')" >Execute no show</button>
                                            </div>
                                           
												<div class="col-sm-6">
													<a href="#"></a>
												</div>
							               </div>
										   <div class="form-group clearfix">
 
											<div class="col-sm-6">
													<button class="btn btn-default col-sm-12" id="claim_btn" >Claim</button>
                                            </div>
												<div class="col-sm-6">
													<a href="#"></a>
												</div>
							               </div>
										   <div class="form-group clearfix">
 
											<div class="col-sm-6">
													<button class="btn btn-default col-sm-12"  onclick="ReDispatch($('#reschddata').text(),'<?=$this->serverurl().$this->basepath().'/tunnel/BookingCabFare/ReDispatch';?>',ReDispatchresults,'<?php echo $_SESSION['admin']['id'];?>')" >Redispatch</button>
                                            </div>
												<div class="col-sm-6">
													<a href="#"></a>
												</div>
							               </div>
				                       </div> 
				                    </div>
								</div>
				             </div>
				<!--state box End-->
				
				<!--Financial box Start-->
						
							<div class="tab-pane fade in" id="financialwrp">
                                <div class="row border" style="margin: -1px 0;">
                                    <div class="col-sm-12 col-md-12">
										<div class="portlet-body">
                                          
                                           	<div class="form-group clearfix">
 
											<div class="col-sm-6">
                                                <h5>Actions	</h5>
                                             </div>
											<div class="col-sm-6">
													<h5>Send Receipes</h5>
 											</div>
											 
                                            </div>
											 
										   <div class="form-group clearfix">
  
											<div class="col-sm-6">
													<button class="btn btn-default col-sm-12" id="genbill" drvrid=""> Generate Bill</button>
														<button class="btn btn-default col-sm-12 disabled">Manual payment</button>
                                            </div>
												<div class="col-sm-6">
													<button class="btn btn-default col-sm-12 disabled" id="clientreceipt" bokid="" onclick="sendclntinvoice($(this).attr('bokid'),'<?=site_url."/tunnel/Menu/sendinvoicemail"?>',sendclntinvoiceresults)">Send receipt to client</button>
													<button class="btn btn-default col-sm-12 disabled" id="driverreceipt">Send receipt to driver</button>
												</div>
												 
							               </div>
							              
				                       </div> 
				                    </div>
								</div>
				             </div>
				<!--Financial box End-->
			
				
            </div>														
        </div>             
    </div>
	
	
<!--clam popup Start-->
<div class="col-sm-4" id="claim" style="padding: 20px; border-radius: 10px;background: rgb(255, 255, 255); display:none;z-index:9999999999999999999999999999999">
		<h1 class="fa fa-times closbtn b-close"></h1><h5 style="margin: 0 0 15px;"><large>Booking</large>&nbsp;<b class="booking_no" id="bokref">1580530343</b></h5>
        <div class="col-sm-12">
		
		 
            <div id="userTabContent" class="tab-content">
						
			 	<!--options box Start-->
						
							<div class="tab-pane fade active in" id="">
                                <div class="row border" style="margin: -1px 0;">
                                    <div class="col-sm-8 col-md-8">
										<div class="portlet-body">
                                          
                                          <div class="form-group clearfix">
 
											<div class="col-sm-12">
                                                <h5>Claim Booking</h5>
													
                                                <!-- Previously used Searching for drivers -->
                          <!-- <div class="input-group">
 													<input type="text" id="taxi_nosUpdate" class="col-sm-12 inputfild" placeholder="Driver" style="
    border-radius: 5px 0px 0px 5px !important;
">
<input type="hidden" id="taxi_nos_idUpdate">
													<span class="input-group-addon"><i class="fa fa-search"></i></span>   
                                                </div> -->
                                                <div >
                                                  <select id="drvrlistings"></select>
                                                  <table>
                                                    <thead><tr>
                                                    <th>Car Names</th>
                                                    <th>Color</th>
                                                  </tr>
                                                    </thead>
                                                    <tbody id="drvrtypes">

                                                    </tbody>
                                                  </table>
                                                </div>
                                            </div>
											
                                            </div>
											
											<div class="form-group clearfix">
 
											<div class="col-sm-6">
													<button class="btn btn-default col-sm-12" id="reserve">Reserve booking</button>
                                            </div>
											<div class="col-sm-6">
													<button class="btn btn-default col-sm-12">Back</button>
                                            </div>
												<div class="col-sm-6">
													<a href="#"></a>
												</div>
							               </div>
				                       </div> 
				                    </div>

                                    <div class="col-sm-4 col-md-4">

 

                                    </div>
								</div>
				             </div>
				<!--options box End-->
 </form>	
            </div>														
        </div>             
    </div>
<!--Clam popup End-->

<div class="col-sm-4" id="Generatebilltab" style="padding: 20px; border-radius: 10px;background: rgb(255, 255, 255); display:none;z-index:9999999999999999999999999999999">
    <h1 class="fa fa-times closbtn b-close"></h1><h5 style="margin: 0 0 15px;"><large>Booking</large>&nbsp;<b class="booking_no" id="bokref">1580530343</b></h5>
        <div class="col-sm-12">
    
     
            <div id="userTabContent" class="tab-content">
            
        <!--options box Start-->
            
              <div class="tab-pane fade active in" id="">
                                <div class="row border" style="margin: -1px 0;">
                                    <div class="col-sm-12 col-md-12">
                                       <div class="portlet-body">
                                          
                                          <div class="form-group clearfix">
 
                                               <div class="col-sm-12" id="genbillresults" >
                                               
                                               </div>
                      
                                            </div>
                                        </div> 
                                    </div>
                                </div>
              </div>
        <!--options box End-->
  
            </div>                            
        </div>             
    </div>

  

<!--popups END-->



<!--Clam popup End-->

<div class="col-sm-4" id="Generateinvoice" style="padding: 20px; border-radius: 10px;background: rgb(255, 255, 255); display:none;z-index:9999999999999999999999999999999">
    <h1 class="fa fa-times closbtn b-close"></h1><h5 style="margin: 0 0 15px;"><large>Booking</large>&nbsp;<b class="booking_no" id="bokref">1580530343</b></h5>
        <div class="col-sm-12">
    
     
            <div id="userTabContent" class="tab-content">
            
        <!--options box Start-->
            
              <div class="tab-pane fade active in" id="">
                                <div class="row border" style="margin: -1px 0;">
                                    <div class="col-sm-12 col-md-12">
                                       <div class="portlet-body">
                                          
                                          <div class="form-group clearfix">
 
                                               <div class="col-sm-12" id="geninvoiceresults" >
                                               
                                               </div>
                      
                                            </div>
                                        </div> 
                                    </div>
                                </div>
              </div>
        <!--options box End-->
  
            </div>                            
        </div>             
    </div>

  

<!--popups END-->



  <div id="myModal" class="modal fade" role="dialog">
  <div class="modal-dialog">

    <!-- Modal content-->
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal">&times;</button>
        <h4 class="modal-title">Execute Payment</h4>
      </div>
      <div class="modal-body">
          <div class="settings" id="nexstepform">
                <input type="button" id="TripDone" name="TripDone" onclick="tripdoneadmin(this.id,'<?= $this->basePath().'/tunnel/BookingCabFare/tripdoneadmin'?>',tripdoneadminresults,0)" value="Trip Done" style="cursor:pointer;">
                <input type="button" id="ExecutePayment" name="ExecutePayment"   value="Execute Payment" onclick="$('#executepaymntform').fadeToggle();" style="cursor:pointer;">
                <div id="executepaymntform" style="display:none;">
                <form id="ExePymntByAdmin" method="post" onsubmit="return ExePymntByAdmin(this.id,$('#payment_type').val(),'<?= $this->basePath().'/tunnel/Menu/ExePymntByAdmin'?>',ExePymntByAdminResults,1)">
                    <select name="payment_type" id="payment_type">
                      <option value="0">Select payment type</option>
                      <option value="Credit">Credit</option>
                      <option value="Cash">Cash</option>
                    </select>
                    <input type="submit" value="Execute Payment" name="ExecPaySub">
                </form>
                </div>
          </div>
      </div>
      <div class="modal-footer">
        <button type="button" onclick="$('#myModal').fadeOut()" class="btn btn-default" data-dismiss="modal">Close</button>
      </div>
    </div>

  </div>
</div>
<script src="https://maps.googleapis.com/maps/api/js"></script> 
<!-- <script async defer  src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCOltTlLALVdO79OezFhXkmPrfQSImo584&callback=initMap"> </script>
 -->
<script>
    $(document).on('click','.delay',function(){
         $.ajax({
		type: 'POST',
		url:'<?php echo $this->basePath();?>'+"/tunnel/admin/delaySMS",
		dataType: "json",
		data : {    
				
				id:$(this).attr('data')
				
			},		 
		success: function(html){
			
			alert(html.id)
			
			},
		error: function(error){
			console.log(error);
		}
	});
    
    });
   /* jQuery.extend(jQuery.fn.dataTableExt.oSort, {
    "stringMonthYear-pre": function (s) {
        var months = ["Jan", "Feb", "Mar", "Apr", "May", "Jun", "Jul", "Aug", "Sep", "Oct", "Nov", "Dec"];
 
        var dateComponents = s.split(" ");
        dateComponents[0] = dateComponents[0].replace(",", "");
        dateComponents[1] = jQuery.trim(dateComponents[1]);
 
        var year = dateComponents[1];
 
        var month = 0;
        for (var i = 0; i < months.length; i++) {
            if (months[i].toLowerCase() == dateComponents[0].toLowerCase().substring(0,3)) {
                month = i;
                break;
            }
        }
 
        return new Date(year, month, 1);
    },
 
    "stringMonthYear-asc": function (a, b) {
        return ((a < b) ? -1 : ((a > b) ? 1 : 0));
    },
 
    "stringMonthYear-desc": function (a, b) {
        return ((a < b) ? 1 : ((a > b) ? -1 : 0));
    }
});
    */
   jQuery.extend( jQuery.fn.dataTableExt.oSort, {
    "alt-string-pre": function ( a ) {
        return a.match(/alt="(.*?)"/)[1].toLowerCase();
    },
 
    "alt-string-asc": function( a, b ) {
        return ((a < b) ? -1 : ((a > b) ? 1 : 0));
    },
 
    "alt-string-desc": function(a,b) {
        return ((a < b) ? 1 : ((a > b) ? -1 : 0));
    }
} );
var id_s;
     var table;
     var data;
     var myVar;
     var data2;
	 var myVar2;
         var i=0;
        var date;
        var time;
        var book_type;
//	 $(".defaultbtnsearch").click(function(){
//             
//             event.preventDefault();
//             
//		 clearInterval(myVar2); 
//		alert("yahoo"); 
//		var driver=$("#driver_name").val();
//		var ref=$("#ref").val();
//		var partner=$("#partner").val();
//		var booking_type=$("#type").val();
//		//table.api().clear();
//      		table.fnDestroy();
//			
//       table=$('#example').dataTable( {
//        "ajax": '<?php echo $this->basePath();?>'+"/tunnel/admin/booking_filter?driver="+driver+"&partner="+partner+"&ref="+ref+"&type="+booking_type,
//        "deferRender": true,
//		  //"bSort":false
//		 //"order": [[ 1, "desc" ]]
//    } );
//		 
//		 
//	 });
	 $( "#myform" ).submit(function( event ) {
  //alert( "Handler for .submit() called." );
  event.preventDefault();
});
$(document).ready(function () {
    clientRating();

        //$("#created_since").datepicker();
	//$("#created_since").datepicker("option","dateFormat","yy-mm-dd");
	//$("#created_to").datepicker();
	//$("#created_to").datepicker("option","dateFormat","yy-mm-dd");

	$("#closed_since").datepicker();
	$("#closed_since").datepicker("option","dateFormat","yy-mm-dd");
	$("#closed_to").datepicker();
	$("#closed_to").datepicker("option","dateFormat","yy-mm-dd");
    
//////////////////


    $( "#created_since" ).datepicker({
      defaultDate: "+1w",
      changeMonth: true,
      numberOfMonths: 1,
	  //dateFormat:"yy-mm-dd",
	   dateFormat:"dd-mm-yy",
      onClose: function( selectedDate ) {
        $( "#created_to" ).datepicker( "option", "minDate", selectedDate );
      }
    });
    $( "#created_to" ).datepicker({
      defaultDate: "+1w",
      changeMonth: true,
      numberOfMonths: 1,
	  //dateFormat:"yy-mm-dd",
	  dateFormat:"dd-mm-yy",
      onClose: function( selectedDate ) {
        $( "#created_since" ).datepicker( "option", "maxDate", selectedDate );
      }
    }); 

 
    var url_new='<?php echo $this->basePath();?>'+'/tunnel/admin/dashboard';
       $('.book_type').click(function(){
        $('.book_type').removeClass('activecol');
        $(this).addClass('activecol');
        $('.remove').remove();
       $('.hour_wise').hide();
       $('.'+$(this).attr("data")).show();
        
        
    });
       $.ajax({
				        type: 'POST',
					headers: { 'auth-token': 'C3PO R2D2' },	//contentType: 'application/json',
				        url: url_new,
				        dataType: "json",
						//data : {userName : name,},		 
				        success: function(data){
				        		for(key in data.key) {
  var infoJSON = data.key[key];
 // alert(infoJSON);
  $('#'+key).html(infoJSON);
}
for(key in data.date_a) {
  var infoJSON = data.date_a[key];
 // alert(infoJSON);
  $('#'+key).append('<span>('+infoJSON+')</span>');
}
	
  for(key in data.hour) {
  var infoJSON = data.hour[key];;
  $('#'+key+'>span').html('('+infoJSON+')');
}
$('.hour_wise_0').removeClass('hide');								
									},
				        error: function(error){
						
								console.log(error);	
						}
			});
       // $('#dataTables-example').dataTable();
       $('.hour').click(function(){
	   //debugger;
	    var date = $(".activecol" ).attr('data');
          //alert(date);
            table.fnDestroy();
			
       table=$('#example').dataTable( {
        "ajax": '<?php echo $this->basePath();?>'+"/tunnel/admin/booking_list?date="+date+'&hour='+$(this).attr('data'),
        "deferRender": true,
    });
       $('.remove').remove();
       $('.hour').removeClass('activecol');
         $(this).addClass('activecol');
       $('.hour_wise').addClass('hide');
	   
datatablsCSS();   
      
       $('.hour_wise_'+$(this).attr('data')).removeClass('hide');
	   //alert($('.hour_wise_'+$(this).attr('data')+'.book_102').length);
	   $("#span_101").html($('.hour_wise_'+$(this).attr('data')+'.book_101').length);
       $("#span_102").html($('.hour_wise_'+$(this).attr('data')+'.book_102').length);
$("#span_103").html($('.hour_wise_'+$(this).attr('data')+'.book_103').length);
$("#span_104").html($('.hour_wise_'+$(this).attr('data')+'.book_104').length);	
     var url2='<?php echo $this->basePath();?>'+'/tunnel/admin/days_wise';
     var hour_new=$(this).attr('data');
     //alert(hour_new);
       $.ajax({
				        type: 'POST',
					headers: { 'auth-token': 'C3PO R2D2' },	//contentType: 'application/json',
				        url: url2,
				        dataType: "json",
                                        
					data : {date :date,hour:hour_new},		 
				        success: function(data){
				        		
$('.hour_wise').remove();
$('#span_101').html("0");
     $('#span_102').html("0");
      $('#span_103').html("0"); $('#span_104').html("0");
for(key in data.hour) {
  var infoJSON = data.hour[key];
 // alert(infoJSON);
 
  $('#'+key+'>span').html('('+infoJSON+')');
}
for(i=0;data.booking_type.length;i++)
{
    
      
    $('#span_'+data.booking_type[i].bookingtype).html(data.booking_type[i].no);
}
        
  
//				for(i=0;i<data.hour_wise.length;i++)
//{
//    
// $('#dataTables-example_1').append('<tr class="hour_wise hide hour_wise_'+data.hour_wise[i].hour+' book_'+data.hour_wise[i].BookingType+'"><td><a class="clickme" data="'+data.hour_wise[i].id+'">'+data.hour_wise[i].ref+'</a></td><td>'+data.hour_wise[i].ContactNo+'</td><td>'+data.hour_wise[i].clientname+'</td><td>'+data.hour_wise[i].bookingdate+'</td><td>'+data.hour_wise[i].partner+'</td><td>'+data.hour_wise[i].pickuparea+'</td><td>'+data.hour_wise[i].driver+'</td><td>'+data.hour_wise[i].status+'</td></tr>');   
// }
$('.hour_wise_0').removeClass('hide');						
								
									},
				        error: function(error){
						
								console.log(error);	
						}
			});
    });
       $('.date').click(function(){
            clearInterval(myVar2); 
           $('.remove').remove();
           $('.date').removeClass('activecol');
           $(this).addClass('activecol');
      // alert($(this).attr('data'));
       $('.hour>span').html('');
       table.fnDestroy();
			date=$(this).attr("data");
			//alert(date);
		/*var obj=	$( "#hourlyWise>td" ).find("td");
			$.each( obj, function( key, value ) {
  alert( key + ": " + value );
});*/
       table=$('#example').dataTable( {
        "ajax": '<?php echo $this->basePath();?>'+"/tunnel/admin/booking_list?date="+date,
        "deferRender": true,
    });
    datatablsCSS();
       var url2='<?php echo $this->basePath();?>'+'/tunnel/admin/days_wise';
       $.ajax({
				        type: 'POST',
					headers: { 'auth-token': 'C3PO R2D2' },	//contentType: 'application/json',
				        url: url2,
				        dataType: "json",
                                        
					data : {date :date},		 
				        success: function(data){
				        		
$('.hour_wise').remove();
$('#span_101').html("0");
     $('#span_102').html("0");
      $('#span_103').html("0"); $('#span_104').html("0");
for(key in data.hour) {
  var infoJSON = data.hour[key];
 // alert(infoJSON);
 
  $('#'+key+'>span').html('('+infoJSON+')');
}
for(i=0;data.booking_type.length;i++)
{
    
      
    $('#span_'+data.booking_type[i].bookingtype).html(data.booking_type[i].no);
}
        
  
//				for(i=0;i<data.hour_wise.length;i++)
//{
//    
// $('#dataTables-example_1').append('<tr class="hour_wise hide hour_wise_'+data.hour_wise[i].hour+' book_'+data.hour_wise[i].BookingType+'"><td><a class="clickme" data="'+data.hour_wise[i].id+'">'+data.hour_wise[i].ref+'</a></td><td>'+data.hour_wise[i].ContactNo+'</td><td>'+data.hour_wise[i].clientname+'</td><td>'+data.hour_wise[i].bookingdate+'</td><td>'+data.hour_wise[i].partner+'</td><td>'+data.hour_wise[i].pickuparea+'</td><td>'+data.hour_wise[i].driver+'</td><td>'+data.hour_wise[i].status+'</td></tr>');   
// }
$('.hour_wise_0').removeClass('hide');						
								
									},
				        error: function(error){
						
								console.log(error);	
						}
			});
                         
        
    });
	$.fn.dataTableExt.sErrMode = 'throw';
        dynamicText(2);
	 $( "#taxi_nosUpdate" ).autocomplete({
  source: '<?php echo $this->basePath();?>'+'/tunnel/admin/alldriver',minLength: 2,
  focus: function( event, ui ) {
	  
	$( "#taxi_nosUpdate" ).val( ui.item.label );
  
	return false;
  },
  select: function( event, ui ) {
	$( "#taxi_nosUpdate" ).val( ui.item.label );
	$( "#taxi_nos_idUpdate" ).val( ui.item.value );
   
	return false;
  }
    
    
}); 
$('#reserve').click(function(){
  // var driver_id=$( "#taxi_nos_idUpdate" ).val();
  var driver_id=$( "#drvrlistings" ).val();
	var bokref=$( "#bokref" ).text();
	var agent_id=<?php echo $_SESSION['admin']['id'];?>
	//alert(id_s);
	//alert(driver_id);
  if(driver_id != 0){

  
	$.ajax({
					
  url: '<?php echo $this->basePath();?>'+"/tunnel/admin/reserve_booking?bokref="+bokref+"&driver_id="+driver_id+"&agent_id="+agent_id,
  cache: false,
  dataType:"json",
  success : function  (html) {
    // body...
      alert(html.message);

  }
}).done(function( html ) {
      // console.log(html);
	//alert(html.data);
	$("#taxi_nosUpdate").val("");
	$(".b-close").click();
	
})

}
else alert("please select the driver to be assigned");
});
////////////
$(document).on('click','.voice_mail',function(){
var val=$(this).attr('data');
//alert(val);
	
$.ajax({
url: '<?php echo $this->basePath();?>'+"/tunnel/admin/fetch_recording?booking_id="+val,
cache: false,
dataType:"json"
}).done(function( html ) {
alert(html.data);
//$("#taxi_nosUpdate").val("");
//$(".b-close").click();
})
});
/////////
 $('#ui-id-1').css('z-index','90000');
		$("#claim_btn").click(function(){
			 // var id = $("")
       var bokid_s=$("#reschddata").text();
			$("#claim").bPopup();
      var querystring = "bokid="+bokid_s;
      var drvrtypsurl = "<?php echo $this->basePath();?>/tunnel/BookingCabFare/CarTypes";
      var callback = drvrtypsurlresults;
      call_ajax_json(querystring,drvrtypsurl,callback); 
			
		})
		jQuery('#datetimepicker').datetimepicker({
			 timepicker:true,
  format:'d.m.Y H:i',
		});
                 $("#execute_noShow").click(function(){
             
           
           $.ajax({
		type: 'POST',
		url:'<?php echo $this->basePath();?>'+"/tunnel/BookingCabFare/ExecuteNoShow",
		dataType: "json",
		data : {    
				
				id:id_s
				
			},		 
		success: function(html){
			 if(html.status == 1){

  			 alert("Booking cancelled Successfully");
         console.log(html);
          // $(".clickme").each(function(){
          // var element = $(this).attr("data");
          // if(element == html.bokid){
          //   $(this).parent().nextAll().eq(7).contents().first()[0].textContent = html.text;
          // }
          // })
       }
       else alert(html.message);
      
			},
		error: function(error){
			console.log(error);
		}
	});
         });

                 
		 $("#change").click(function(){
             
           var time=$('#datetime').val();

            var id_s=$("#reschddata").text();

           $.ajax({
		type: 'POST',
    // url:'<?php echo $this->basePath();?>'+"/tunnel/admin/changetime",//previously used url
		url:'<?php echo $this->basePath();?>'+"/tunnel/BookingCabFare/reschdbkingjobs",
    // async:false,
		dataType: "json",
		data : {    
				time:time,
				id:id_s,
				reschd:1
			},		 
		success: function(html){

      // location.
      if(html.status == 1){

        alert(html.message);
        // alert(html.bokid);
        // alert(html.newtime);
        $(".clickme").each(function(){
          var element = $(this).attr("data");
          if(element == html.bokid){
            $(this).parent().next().text(html.newtime);
          }
        })
 
      }
      else alert(html.message);
			
			// var len = html.data.length;
			// var detailCity = "";
			// for(var i=0;i<len;i++){
			// 	detailCity += "<option value='"+html.data[i].id+"'>"+ html.data[i].name+"</option>";
			
			// }
			// 	$("#addCab_cityDropdown").html(detailCity);
			
			},
		error: function(error){
			console.log(error);
		}
	});
         });
		
		$('#example').on('click','.action',function(){
		$('#showchngtymbox').css('display','none');
		id_s=$(this).attr("data");
			//alert(id_s);
        		var request=$.ajax({
					
  url: '<?php echo $this->basePath();?>'+"/tunnel/admin/booking_action?id="+id_s,
  cache: false,
  dataType:"json"
});
  request.done(function( html ) {
      alert(html.data.ref);
   $(".booking_no").html(html.data.ref);
   $("#reschddata").html(id_s);
   $("#genbill").attr("drvrid",html.data.pickup);
   $("#datetimepicker").val(html.data.date);
   $(".client_profile").attr('href','<?php echo $this->basePath();?>/admin/client?client='+html.data.client);
   $(".driver_profile").attr('href','<?php echo $this->basePath();?>/admin/driver?driver='+html.data.pickup);
   //$("#booking_no").html(html.data.ref);
   
   // if(html.data.stat>2)
   if(!(html.data.stat<8 && html.data.stat>0))
   {
	   $("#claim_btn").addClass("disabled");
	   
   }else{
	   
	   $("#claim_btn").removeClass("disabled");
   }

       if(jQuery.inArray(html.data.stat,  ['3','8','16','17']) ==-1)
       {
         $("#clientreceipt").addClass("disabled");
         
       }else{
         
         $("#clientreceipt").removeClass("disabled");
         $("#clientreceipt").attr("bokid",html.data.ref);
       }
       // alert(jQuery.inArray(html.data.stat, ['3','8','16','17']));
  $("#booking_action").bPopup();
  
  });
request.fail(function( jqXHR, textStatus ) {
  alert( "Request failed: " + textStatus );
});
	  
			$(function(){
     
  
  $('#time').combodate({
        firstItem: 'name', //show 'hour' and 'minute' string at first item of dropdown
        minuteStep: 1,
    customClass: 'form-control'
    });
  // $('#datetime').change(function(){
  //     var reschdtime = $(this).val();
  //       if(reschdtime == ""){
  //        alert("New time can not be null");
  //        $("#change").attr("dsiabled" , true);
  //      }
  //      else $("#change").attr("dsiabled" , false);
  //       // alert($(this).val());
  // }); 


});
			
			
		});

	$(document).on('click','#change_picktime',function(){
	var dateTime	=	$('#datetimepicker').val();
	$('#datetime').combodate('setValue', dateTime); 
	});
		
         $(document).on('click','.driver_click',function(){
           clearInterval(myVar2); 
         if($(this).hasClass('open'))
      {
 myVar2=setInterval(function(){myTimer2()}, 30000);	  
          $(".remove div:first").slideUp(400,function(){
               $('.remove').remove();
              
          });
     
      $(this).removeClass('open');
	  
  }else{
      $('.remove').remove();
       var divd=$(this).parent().parent();
       $(this).addClass('open');
       data=$(this).attr("data");
       $.ajax({
  url: '<?php echo $this->basePath();?>'+"/tunnel/admin/driver_info?id="+data,
  cache: false,
  dataType:"json"
})
  .done(function( html ) {
      console.log(html);
    
	
	if(html.data.com_id=="")
	{
		divd.after('<tr class="remove" ><td colspan="9"><div class="portlet portlet-default">  <div id="myTabContent" class="tab-content contantboxoftabs"> <div class="tab-pane fade in active" id="home1"><h4 class="h4textmrn0">Driver Details</h4><div style=""><table id="driverinfo" class="table table-striped table-responsive"><tr><th>Transport Details</th><td>Name</td><td>'+html.data.operational_company_name+'</td></tr><tr><th></th><td>Contact No</td><td>'+html.data.ContactNo+'</td></tr><tr><th></th><td>Primary Language</td><td>'+html.data.lang_speak+'</td></tr><tr><th></th><td>Average Rating</td><td></td></tr><tr><th>Driver Group</th><td>Name</td><td>'+html.data.group_name+'</td></tr><tr><th></th><td>Group Owner</td><td>'+html.data.vendor_name+'</td></tr><tr><th>Driver</th><td>Name</td><td>'+html.data.driver_name+'</td></tr><tr><th></th><td>Contact No</td><td>'+html.data.ContactNo+'</td></tr><tr><th></th><td>Current Status</td><td>'+html.data.status+'</td></tr><tr><th></th><td>Current Signup Status</td><td>'+html.data.curr_status+'</td></tr><tr><th></th><td>Average Rating (60 days)</td><td></td></tr><tr><th></th><td>Bank IBAN</td><td>'+html.data.account_no+'</td></tr><tr><th></th><td>Bank Swift</td><td>'+html.data.rtgs_neft+'</td></tr><tr><th>Vehicle</th><td>License Plate</td><td>'+html.data.CabRegistrationNumber+'</td></tr><tr><th></th><td>Make</td><td>'+html.data.CabName+'</td></tr><tr><th></th><td>Model</td><td>'+html.data.model+'</td></tr><tr><th></th><td>Year</td><td>'+html.data.model+'</td></tr><tr><th></th><td>Color</td><td>'+html.data.CabColor+'</td></tr><tr><th></th><td>Vehicle Type</td><td>'+html.data.v_type+'</td></tr></table></div></div></div></td></tr>');
		
		
	}else{
		
		divd.after('<tr class="remove" ><td colspan="9"><div class="portlet portlet-default">  <div id="myTabContent" class="tab-content contantboxoftabs"> <div class="tab-pane fade in active" id="home1"><h4 class="h4textmrn0">Driver Details</h4><div style=""><table id="driverinfo" class="table table-striped table-responsive"><tr><th>Transport Details</th><td>Name</td><td>'+html.data.operational_company_name+'</td></tr><tr><th></th><td>Contact No</td><td>'+html.data.ContactNo+'</td></tr><tr><th></th><td>Primary Language</td><td>'+html.data.lang_speak+'</td></tr><tr><th></th><td>Average Rating</td><td></td></tr><tr><th>Driver Group</th><td>Name</td><td>'+html.data.group_name+'</td></tr><tr><th></th><td>Group Owner</td><td>'+html.data.vendor_name+'</td></tr><tr><th>Driver</th><td>Name</td><td>'+html.data.driver_name+'</td></tr><tr><th></th><td>Contact No</td><td>'+html.data.ContactNo+'</td></tr><tr><th></th><td>Current Status</td><td>'+html.data.status+'</td></tr><tr><th></th><td>Current Signup Status</td><td>'+html.data.curr_status+'</td></tr><tr><th></th><td>Average Rating (60 days)</td><td></td></tr><tr><th></th><td>Bank IBAN</td><td>'+html.data.account_no+'</td></tr><tr><th></th><td>Bank Swift</td><td>'+html.data.rtgs_neft+'</td></tr><tr><th>Vehicle</th><td>License Plate</td><td>'+html.data.CabRegistrationNumber+'</td></tr><tr><th></th><td>Make</td><td>'+html.data.CabName+'</td></tr><tr><th></th><td>Model</td><td>'+html.data.model+'</td></tr><tr><th></th><td>Year</td><td>'+html.data.model+'</td></tr><tr><th></th><td>Color</td><td>'+html.data.CabColor+'</td></tr><tr><th></th><td>Vehicle Type</td><td>'+html.data.v_type+'</td></tr><tr><th>Complaint</th><td>Complaint  Type</td><td>'+html.data.com_type+'</td></tr><tr><th></th><td>Complaint Subtype</td><td>'+html.data.sub_type+'</td></tr><tr><th></th><td>Caller Name</td><td>'+html.data.com_caller+'</td></tr><tr><th></th><td>CSR</td><td>'+html.data.csr+'</td></tr><tr><th></th><td>Complaint Description</td><td>'+html.data.com_desc+'</td></tr><tr><th></th><td>Current Status</td><td>'+html.data.com_status+'</td></tr></table></div></div></div></td></tr>');
		
		
	}
  
  });
       
     
   
    
   
    
    }
            
            
        });
        $(document).on('click','.client',function(){
           clearInterval(myVar2); 
         if($(this).hasClass('open'))
      {
 myVar2=setInterval(function(){myTimer2()}, 30000);	  
          $(".remove div:first").slideUp(400,function(){
               $('.remove').remove();
              
          });
     
      $(this).removeClass('open');
	  
  }else{
	   
      $('.remove').remove();
       var divd=$(this).parent().parent();
       $(this).addClass('open');
       data=$(this).attr("data");
       $.ajax({
  url: '<?php echo $this->basePath();?>'+"/tunnel/admin/client_information?client_id="+data,
  cache: false,
  dataType:"json"
})
  .done(function( html ) {
      
    divd.after('<tr class="remove" ><td colspan="9"><div class="portlet portlet-default">  <div id="myTabContent" class="tab-content contantboxoftabs"> <div class="tab-pane fade in active" id="home1"><h4 class="h4text" style="margin:0 !important;">Client Information</h4><div style=""><table id="clientinfo" class="table table-striped table-responsive"><tr><th>Client Name</th><td>'+html.data[0].clientname+'</td></tr><tr><th>Contact</th><td>'+html.data[0].contact+'</td></tr><tr><th>Email</th><td>'+html.data[0].email+'</td></tr><tr><th>Alt Email</th><td>'+html.data[0].altemail+'</td></tr><tr><th>Landline</th><td>'+html.data[0].landline+'</td></tr></table></div></div></div></td></tr>');
  
  });
       
     
   
    
   
    
    }
            
            
        });
        $(document).on('click','.clickme',function(){
        	
        i=1;
      
             
          clearInterval(myVar2);
          clearInterval(myVar);
          i=0;
      // alert("fdfdfdfdfdfd");
      if($(this).hasClass('open'))
      {
 myVar2=setInterval(function(){myTimer2()}, 30000);	  
          $(".remove div:first").slideUp(400,function(){
               $('.remove').remove();
              
          });
     
      $(this).removeClass('open');
	  
  }else{
	 
      $('.remove').remove();
       
       $(this).addClass('open');
       
      $(this).parent().parent().after('<tr class="remove" ><td colspan="13"><div style="display:none"> <div class=""> <!--<div class="portlet portlet-default"> <div class="portlet-heading"> <div class="portlet-title"></div>--> <div class="clearfix"></div> </div> <div class="portlet-body"> <ul id="myTab" class="nav nav-tabs tabsdesign"> <li class="active"><a href="#home1" data-toggle="tab"><i class="fa fa-list" style="color:#; margin:5px"></i>Status</a> </li> <li><a href="#bookinginfo" data-toggle="tab"><i class="fa fa-user" style="color:#; margin:5px"></i>Booking Details</a> </li><li><a href="#payment" data-toggle="tab"><i class="fa fa-user" style="color:#; margin:5px"></i> Payment Details</a> </li><li><a href="#driver_alloc" data-toggle="tab"><i class="fa fa-user" style="color:#; margin:5px"></i>Driver Allocation</a> </li><li><a href="#way_point" data-toggle="tab" class="way_points_show"><i class="fa fa-user" style="color:#; margin:5px"></i>Way Points</a> </li></li></ul> <div id="myTabContent" class="tab-content contantboxoftabs"> <div class="tab-pane fade in active" id="home1"><h5 class="h4text" style="background: #E2E2E2;padding:7px;margin: 0;">Status</h5><table id="example2" class="table table-striped table-responsive"><thead> <tr> <th style="width:33%;">Date</th> <th style="width:33%;">State</th> <th style="width:33%;">Text</th> </tr> </thead> <tbody> </tbody> </table></div><div class="tab-pane fade" id="payment"><h5 class="h4text" style="background: #E2E2E2;padding:7px;margin: 0;">Payment Details</h5><table id="paymentdetail" class="table table-responsive table-striped"></table></div><div class="tab-pane fade" id="bookinginfo"><h5 class="h4text" style="background: #E2E2E2;padding:7px;margin: 0;">Booking Information</h5><table id="bookinf" class="table table-responsive table-striped"></table></div><div id="driver_alloc" class="tab-pane fade"><h5 class="h4text" style="background: #E2E2E2;padding:7px;margin: 0;">Driver Allocation</h5><table id="driver_alloc_2" class="table table-striped table-responsive"><thead> <tr> <th>Driver</th> <th>Vehicle</th> <th>Created</th><th>Allocation Status</th> </tr> </thead> <tbody> </tbody> </table></div><div id="way_point" class="tab-pane fade"><h5 class="h4text" style="background: #E2E2E2;padding:7px;margin: 0;">Way Points</h5><div id="map"></div></div></div></td></tr>');
   
    data=$(this).attr("data");
    rel=$(this).attr("rel");
    
    $.ajax({
  url: '<?php echo $this->basePath();?>'+"/tunnel/admin/booking_information?booking_id="+data,
  cache: false,
  dataType:"json"
})
  .done(function( html ) {
	  $('#example2 tbody').html('');
    for(var i=0;i<html.data.length;i++)
{
                               $('#example2 tbody').append('<tr><td>'+html.data[i].time+'</td><td>'+html.data[i].status+'</td><td>'+html.data[i].message+'</td></tr>');  
  }
  });
  $.ajax({
  url: '<?php echo $this->basePath();?>'+"/tunnel/admin/payment_information?booking_id="+data,
  cache: false,
  dataType:"json"
})
  .done(function( html ) {
    
                      $('#paymentdetail').append('<tr><th></th><th>Created At</th><td>'+html.data[0].created_at+'</td></tr><tr><th></th><th>Is Paid</th><td>'+html.data[0].is_paid+'</td></tr><tr><th></th><th>Paid At</th><td>'+html.data[0].paid_at+'</td></tr><tr><th>Price</th><th>Currency</th><td>'+html.data[0].currency+'</td></tr><tr><th></th><th>Invoice Number</th><td>'+html.data[0].invoice_number+'</td></tr><tr><th></th><th>External Refernece</th><td></td></tr><tr><th></th><th>Payment Type</th><td>'+html.data[0].payment_type+'</td></tr><tr><th></th><th>Fees</th><td>'+html.data[0].fees+'</td></tr><tr><th></th><th>Total Price </th><td>'+html.data[0].total_price+'</td></tr><tr><th></th><th>Total Tax Price</th><td>'+html.data[0].total_tax_price+'</td></tr>');  
                       $('#bookinf').append('<tr><th colspan="2">In</th><th colspan="2">Out</th><th colspan="2">Driver</th><th colspan="2">Client</th></tr><tr><td style="width:15%;">Booking Id</td><td style="width:15%;">'+html.data[0].book_ref+'</td><th style="width:20%;">External Booking Reference</th><td style="width:12.5%;">N/A</td><th style="width:10%;">Rating</th><td style="width:10%;">'+html.data[0].driver_rating+'</td><th style="width:12.5%;">Rating</th><td style="width:12.5%;">'+html.data[0].client_rating+'</td></tr><tr><th>UserAgent</th><td>'+html.data[0].useragent+'</td><th>Arrival Time Pre</th><td>'+html.data[0].arrival_time_pre+'</td><th>Reason</th><th></th><th>Reason</th><th></th></tr><tr><th>Comments for the client</th><td></td><th>Arrival Time Post</th><td>'+html.data[0].arrival_time_post+'</td><th>Comment</th><td></td><th>Comment</th><td></td></tr><tr><th>Comment For the driver</th><td></td><th>Arrival Time Actual</th><td>'+html.data[0].arrival_time_actual+'</td><th></th><th></th><th></th><th></th></tr><tr><th>Drivers Note</th><td>'+html.data[0].driver_note+'</td><th>Expiration Time</th><td>'+html.data[0].expiration_time+'</td><th></th><th></th><th></th><th></th></tr><tr><th>Clients Note</th><td>'+html.data[0].client_note+'</td><th>Actual Driving Duration</th><td>'+html.data[0].actual_driven_duration+'</td><th></th><th></th><th></th><th></th></tr><tr><th>Features</th><td>'+html.data[0].features+'</td><th>Actual Waiting Distance</th><td>'+html.data[0].actual_waiting_distance+'</td><th></th><th></th><th></th><th></th></tr><tr><th>Vehicle Type</th><td>'+html.data[0].cab_name+'</td><th>Actual Distance</th><td>'+html.data[0].actual_distance+'</td><th></th><th></th><th></th><th></th></tr><tr><th>Is account booking</th><td>'+html.data[0].is_account_booking+'</td><th>Booking Type</th><td>'+html.data[0].bookingtype+'</td><th></th><th></th><th></th><th></th></tr><tr><th>Is Corporate Booking</th><td>'+html.data[0].is_corporate_booking+'</td><th>Booking Date</th><td>'+html.data[0].bookingdate+'</td><th></th><th></th><th></th><th></th></tr><tr><th>Is account booking</th><td>'+html.data[0].is_account_booking+'</td><th>Pickup Date</th><td>'+html.data[0].pickupdate+'</td><th></th><th></th><th></th><th></th></tr><tr><th>Is credit card Available</th><td></td><th>Pickup Area</th><td>'+html.data[0].pickuparea+'</td><th></th><th></th><th></th><th></th></tr><tr><th>Voucher Id</th><td>'+html.data[0].voucher_id+'</td><th>Pickup Address</th><td>'+html.data[0].pickupaddress+'</td><th></th><th></th><th></th><th></th></tr><tr><th>Voucher Type</th><td>'+html.data[0].voucher_type+'</td><th>Drop Address</th><td>'+html.data[0].dropaddress+'</td><th></th><th></th><th></th><th></th></tr><tr><th>Voucher Amount</th><td></td><th>Drop Area</th><td>'+html.data[0].droparea+'</td><th></th><th></th><th></th><th></th></tr><tr><th>Estimated Distance</th><td>'+html.data[0].estimated_distance+'</td><th></th><th></th><th></th><th></th><th></th><th></th></tr><tr><th>Estimated Time</th><td>'+html.data[0].estimated_time+'</td><th></th><th></th><th></th><th></th><th></th><th></th></tr><tr><th>Estimated Price</th><td>'+html.data[0].estimated_price+'</td><th></th><th></th><th></th><th></th><th></th><th></th></tr>');
					   $('#bookinginfo').append('<div class="col-sm-12 marginbottom20" style="margin-top: 25px;"><a href="#" class="btn btn-default marginright" id="export_booking_info"><i class="fa fa-download marginright"></i>Download CSV</a></div>');
					   //initMap();
  });

////////Code for Way Points Starts Here ////

$.ajax({
  url: '<?php echo $this->basePath();?>'+"/tunnel/admin/waypoint_info",
  cache: false,
  dataType:"json",
  data : {    
		booking_id:data,
		driver_id:rel
	},	
})
	
.done(function(data) {
 		//alert(data.status);  
 		if(data.status=="true"){
		//alert('Mohit');
		var way_points	= JSON.stringify(data.data);
		var way_points1	= jQuery.parseJSON(way_points);
		var start_lat	=	way_points1[0].lat;
		var start_lng	=	way_points1[0].lng;
		///
		var end_lat		=	data.end_lat;
		var end_long	=	data.end_long;

		var pickup_lat	=	data.pickup_lat;
		var pickup_lng	=	data.pickup_lng;
	

		
		debugger;
		alert(way_points);
		var map = new google.maps.Map(document.getElementById('map'), {
	          zoom: 16,
	          //center: {lat: 0, lng: -180},
	          center: {lat: start_lat, lng: start_lng},
	          mapTypeId: google.maps.MapTypeId.DRIVING
	        });

		var userCoor = [["Driver Pickup", start_lat, start_lng],
		                ["Driver Drop", end_lat, end_long],
		                ["Booking Pickup", pickup_lat, pickup_lng]];
		
	        var flightPlanCoordinates = way_points1;
	        var flightPath = new google.maps.Polyline({
	          path: flightPlanCoordinates,
	          geodesic: true,
	          strokeColor: '#0000FF',
	          strokeOpacity: 1.0,
	          strokeWeight: 3,
	          fillColor: '#0000FF',
	          fillOpacity: 0.1
	        });

	        flightPath.setMap(map);

	        var flightPlanCoordinates1 = [
	                                     {lat: start_lat, lng: start_lng},
	                                     {lat: pickup_lat, lng: pickup_lng}	                                     
	                                   ];


	        var flightPath1 = new google.maps.Polyline({
		          path: flightPlanCoordinates1,
		          geodesic: true,
		          strokeColor: '#FF0000',
		          strokeOpacity: 1.0,
		          strokeWeight: 3,
		          fillColor: '#FF0000',
		          fillOpacity: 0.1
		        });

	        flightPath1.setMap(map);
	        
			var infowindow = new google.maps.InfoWindow();
			
			var marker, i;
			
			for (i = 0; i < userCoor.length; i++) {  
			  marker = new google.maps.Marker({
			    position: new google.maps.LatLng(userCoor[i][1], userCoor[i][2]),
			    map: map
			  });
			
			
			  google.maps.event.addListener(marker, 'click', (function(marker, i) {
			    return function() {
			      infowindow.setContent(userCoor[i][0]);
			      infowindow.open(map, marker);
			    }
			  })(marker, i));
			
			}
			///

	        
 	 	}
 });

/////// Code for Way Points Ends Here //////

      myVar = setInterval(function(){myTimer()}, 30000);
      function myTimer(){
        
     $.ajax({
  url: '<?php echo $this->basePath();?>'+"/tunnel/admin/booking_information?booking_id="+data,
  cache: false,
  dataType:"json"
})
  .done(function( html ) {
      $('#example2 tbody').html('');
    for(var i=0;i<html.data.length;i++)
{
                               $('#example2 tbody').append('<tr><td>'+html.data[i].time+'</td><td>'+html.data[i].status+'</td><td>'+html.data[i].message+'</td></tr>');  
  }
  });    
	$.ajax({
		url: '<?php echo $this->basePath();?>'+"/tunnel/admin/driver_alloc?booking_id="+data,
		cache: false,
		dataType:"json"
	})
	.done(function( html ) {
    $('#driver_alloc_2 tbody').html('');
		for(var i=0;i<html.data.length;i++)
		{
			$('#driver_alloc_2').append('<tr><td>'+html.data[i].driver_name+'</td><td>'+html.data[i].vehicle+'</td><td>'+html.data[i].created+'</td><td>'+html.data[i].status+'</td></tr>');  
		}
	});  

   
    }
   
   $(".remove div:first").slideDown(400,function(){
       //e.preventDefault();
    }
    );
  }
    });
       
	   table=$('#example').dataTable( {
        "ajax": '<?php echo $this->basePath();?>'+"/tunnel/admin/booking_list",
        "deferRender": true,
          responsive: false,
          "order": [[ 1, "desc" ]],
          columnDefs: [
       { type: 'alt-string', targets: 1 }
     ],
		   //"bSort":false,
		 //"bStateSave": true,
		  
		  
    } );
    datatablsCSS();
   
	myVar2=setInterval(function(){myTimer2()},30000);
	function myTimer2(){
		//alert(table.fnGetData().length);
	   //alert("yahoo");
           if(i!=1)
           {
	
            table.api().ajax.reload(null,true);
        }
	//table.api().fnStandingRedraw();    
		
		
	}
	$('#example').css("width",'');    
	$("#example_wrapper div:first").attr("class","tbsearchrow clearfix");
	$("#example_wrapper").attr("style","border: 1px solid #d2d2d2;margin: -5px 0;");
	$("#example_wrapper").addClass("clearfix");
	$("#example_info").parent().parent().removeClass("row");
   
});
// CSV Generator
/*
$(".export").on('click', function (event) {
       
	$('#example').tableExport({type:'csv',escape:'true'});
	   
});
*/
$(".export").on('click', function (event) {
       
		//Get table
		var table = $("#example")[0];
		//Get number of rows/columns
		var rowLength = table.rows.length;
		var colLength = table.rows[0].cells.length;
		colLength = colLength - 1;
		
		//Declare string to fill with table data
		var tableString = "";
		var tableHeader = "";
		var tableBody = "";
		//Get column headers
		for (var i = 0; i < colLength; i++) {
			tableHeader += table.rows[0].cells[i].innerHTML.split(",").join("") + ",";
		}
		tableHeader = tableHeader.substring(0, tableHeader.length - 1);
		tableHeader += "\r\n";
			
		//Get row data
		for (var j = 1; j < rowLength; j++) {
			for (var k = 0; k < colLength; k++) {
				tableString += table.rows[j].cells[k].innerHTML.split("<br>").join("") + ",";
				//tableString += table.rows[j].cells[k].innerHTML.split(",").join("") + ",";
				
			}
			//
			tableString += "\r\n";
		}
		
		tableBody += $(tableString).text();
		
		tableString = tableHeader + tableBody;
		
		var date = new Date();
		date = date.toUTCString();
		
		
		//Save file
		if (navigator.appName == "Microsoft Internet Explorer") {
			//Optional: If you run into delimiter issues (where the commas are not interpreted and all data is one cell), then use this line to manually specify the delimeter
			 tableString = 'sep=,\r\n' + tableString;
			 myFrame.document.open("text/html", "replace");
			 myFrame.document.write(tableString);
			 myFrame.document.close();
			 myFrame.focus();
			 myFrame.document.execCommand('SaveAs', true, 'Booking data('+ date +').csv');
		 } else {
			csvData = 'data:application/csv;charset=utf-8,' + encodeURIComponent(tableString);
			 $(event.target).attr({
				 'href': csvData,
				 'target': '_blank',
				 'download': 'Booking('+ date +').csv'
			 });
			 
		 }
		
		
    });
$("#example").on("click", "#export_booking_info", function (event) {
		//Get table
		var table = $("#bookinf")[0];
		//Get number of rows/columns
		var rowLength = table.rows.length;
		var colLength = table.rows[0].cells.length;
		
		//Declare string to fill with table data
		var tableString = "";
		var tableHeader = "";
		var tableBody = "";
		//Get column headers
		for (var j = 0; j < rowLength; j++) {
			for (var i = 0; i < colLength; i++) {
				tableString += table.rows[j].cells[i].innerHTML.split(",").join("") + ",";
			}
			tableString += "\r\n";
		}
		
		var date = new Date();
		date = date.toUTCString();
		//alert(date);
		
		//Save file
		if (navigator.appName == "Microsoft Internet Explorer") {
			//Optional: If you run into delimiter issues (where the commas are not interpreted and all data is one cell), then use this line to manually specify the delimeter
			 tableString = 'sep=,\r\n' + tableString;
			 myFrame.document.open("text/html", "replace");
			 myFrame.document.write(tableString);
			 myFrame.document.close();
			 myFrame.focus();
			 myFrame.document.execCommand('SaveAs', true, 'Booking data('+ date +').csv');
		 } else {
			csvData = 'data:application/csv;charset=utf-8,' + encodeURIComponent(tableString);
			 $(event.target).attr({
				 'href': csvData,
				 'target': '_blank',
				 'download': 'Booking('+ date +').csv'
			 });
			 
		 }
		
		
    });
 
	 
    


function datatablsCSS(){
	$(".paging_simple_numbers").parent().addClass('pgnt_topfix');
        $('.dataTables_length').parent().removeClass('col-sm-6');
        $('.dataTables_length').parent().addClass('col-sm-2');
        $('.dataTables_length').parent().addClass('pgno_top');
	$('.pgno_top').attr("style","top:29px;");
	$('.pgnt_topfix').attr("style","top:28px;");
	
	$('#example').css("width",'');    
	$("#example_wrapper div:first").attr("class","tbsearchrow clearfix");
	$("#example_wrapper").attr("style","border: 1px solid #d2d2d2;margin: -5px 0;");
	$("#example_wrapper").addClass("clearfix");
	$("#example_info").parent().parent().removeClass("row");
}
$('.inputchange').keypress(function(e){
	var key=e.which;
	if(key==13)
	{
		$('.searchBooking').click();
	}
});
function clientRating() {
		
		$.ajax({
			type: 'POST',
			url: '<?php echo $this->basePath();?>'+'/tunnel/admin/fetch_bookingFilter_dropDown',
			dataType: "json",
			success: function(html){
				var len = html.rating_point.length;
				var detailComplaint = "";
				for(var i=0;i<len;i++){
                                    detailComplaint += "<option value='"+html.rating_point[i][2]+"'>"+html.rating_point[i][3]+"</option>";
				}
                                
                                var len1 = html.booking_status.length;
				var detailComplaint1 = "";
                                var detailComplaint111 = "<option value=''>All</option>";
				for(var i=0;i<len1;i++){
                                    detailComplaint1 += "<option value='"+html.booking_status[i][2]+"'>"+html.booking_status[i][3]+"</option>";
				}
				detailComplaint12=detailComplaint111 + detailComplaint1;
				
				
				 var len11 = html.booking_status1.length;
				var detailComplaint11 = "";
                                var detailComplaint111 = "<option value=''>All</option>";
				for(var i=0;i<len11;i++){
                                    detailComplaint11 += "<option value='"+html.booking_status1[i][2]+"'>"+html.booking_status1[i][3]+"</option>";
				}
				detailComplaint1111=detailComplaint111 + detailComplaint11;
                                
                                var len2 = html.paymentType.length;
				var detailComplaint2 = "";
				for(var i=0;i<len2;i++){
                                    detailComplaint2 += "<option value='"+html.paymentType[i][3]+"'>"+html.paymentType[i][3]+"</option>";
				}
                                
                                var len3 = html.isPaid.length;
				var detailComplaint3 = "";
				for(var i=0;i<len3;i++){
                                    detailComplaint3 += "<option value='"+html.isPaid[i][2]+"'>"+html.isPaid[i][3]+"</option>";
				}
                                
                                var len4 = html.orderTime.length;
				var detailComplaint4 = "";
				for(var i=0;i<len4;i++){
                                    detailComplaint4 += "<option value='"+html.orderTime[i][2]+"'>"+html.orderTime[i][3]+"</option>";
				}
                                
				$("#client_rating").html(detailComplaint);
                                $("#driver_rating").html(detailComplaint);
                                //$("#booking_status").html(detailComplaint12);
								$("#booking_status").html(detailComplaint1111);
				$("#select").html(detailComplaint1111);
                                
                                $("#payment_types").html(detailComplaint2);
                                $("#is_paids").html(detailComplaint3);
                                $("#order_time").html(detailComplaint4);
			},
			error: function(error){
				console.log(error);
			}
		});
                
                $.ajax({
			type: 'POST',
			url: '<?php echo $this->basePath();?>'+'/tunnel/admin/fetch_cabType',
			dataType: "json",
			success: function(html){
				var len = html.data.length;
				var detailComplaint = "";
				for(var i=0;i<len;i++){
                                    detailComplaint += "<option value='"+html.data[i][1]+"'>"+html.data[i][0]+"</option>";
				}
				$("#vehicle_type").html(detailComplaint);
			},
			error: function(error){
				console.log(error);
			}
		});
}
//$("#select").change(function () {
//var id=$('#select').val();
//alert(id);
//filter(id);
//});
function filter(id)
{

//alert (id);
                var status=id;
                
                //var client_first=$("#client_first_name").val();
                //var vehicle_owner=$("#vehicle_owner").val();
		//table.api().clear();
      		table.fnDestroy();
			
       table=$('#example').dataTable( {
        "ajax": '<?php echo $this->basePath();?>'+"/tunnel/admin/booking_filter1?status="+status,
        "deferRender": true,
      
		  //"bSort":false
		 //"order": [[ 1, "desc" ]]
    } );
	datatablsCSS();
		 
		 
}
$(".searchBooking").click(function(){
             
      
                var id=$('#select').val();

                //this code is not used and not make sense of using in this field.
                var id1=$('#booking_status').val();
                if(id!="" || id1!="")
                {
                		filter(id);
                
							if (id1==""){
									filter(id);
							}
							else{
									filter(id1);
							}   

                }
                else
                {  
                
               
		var driver=$("#driver_name").val();
		var ref=$("#ref").val();
		var partner=$("#partner").val();
		var booking_type=$("#type").val();
                var created_since=$("#created_since").val()
                var created_to=$("#created_to").val();
                var client_first=$("#client_first_name").val();
                var client_last=$("#client_last_name").val();
                var client_mobile=$("#client_mob").val();
                var client_email=$("#client_email").val();
                var driver_first=$("#driver_first_name").val();
                var driver_last=$("#driver_last_name").val();
                var driver_ids=$("#driver_ids").val();
                var driver_ref=$("#driver_ext_ref").val();
                var driver_mob=$("#driver_mob").val();
                var driver_email=$("#driver_email").val();
                
                //var client_first=$("#client_first_name").val();
                //var vehicle_owner=$("#vehicle_owner").val();
		//table.api().clear();
      		table.fnDestroy();
			
       table=$('#example').dataTable( {
        "ajax": '<?php echo $this->basePath();?>'+"/tunnel/admin/booking_filter?driver="+driver+"&partner="+partner+"&ref="+ref+"&type="+booking_type+"&created_since="+created_since+"&created_to="+created_to+"&client_first="+client_first+"&client_last="+client_last+"&client_mob="+client_mobile+"&client_email="+client_email+"&driver_first="+driver_first+"&driver_last="+driver_last+"&driver_ids="+driver_ids+"&driver_ref="+driver_ref+"&driver_mob="+driver_mob+"&driver_email="+driver_email,
        "deferRender": true,
      
		  //"bSort":false
		 //"order": [[ 1, "desc" ]]
    } );
	datatablsCSS();
       }		 
		 
});

//// Coding to calculate the Bill Forcely By Mohit Jain Starts Here ////

// $(document).on('click','.calc_bill',function(){
$(document).on('click','#genbill',function(){
// var booking_id	=	$(this).attr("booking_id");
var driver_id	=	$(this).attr("drvrid");
var booking_id  = $("#bokref").text();
alert(booking_id);
// var url = '<?php echo $this->basePath();?>'+"/tunnel/menu/cabBillingCompleteAdmin";
var url = '<?php echo $this->basePath();?>'+"/tunnel/menu/livebillgenadmin";
$.ajax({
type: 'POST',
url: url,
dataType: "json",
data : {    
	booking_id:booking_id,
	driver_id:driver_id,
  hour:0,
  km:0,
  pre_wait:0,
  wait:0,
  extrachrgs:0
},		 
success: function(data){ 
      $("#Generatebilltab").bPopup();
      $("#genbillresults").html("");
      // console.log(data.record);
      // $.each(data.totalbill,function(i,val){

      $("#genbillresults").html(data.totalbill);
      // })
  
	// if(data.status == 'true'){
	// 	alert(data.totalbill);
	// }else{
	// 	//alert('Jain');
	// }
  $(".slidingDiv").hide();
  $(".show_hide").show();
  
  $('.show_hide').click(function(){
  $(".slidingDiv").slideToggle();
  });

},
error: function(error){
	console.log(error);	
}
});
     
 });

////Coding to calculate the Bill Forcely By Mohit Jain Ends Here ////
$(document).on('click','a[href=#way_point]',function(){
	alert('Way Points');
	setTimeout(function(){
        google.maps.event.trigger(map, 'resize');
    }, 50);
});



/*$(document).on('click','.way_points_show',function(){
	initMap();

	function initMap() {
        var map = new google.maps.Map(document.getElementById('map'), {
          zoom: 3,
          center: {lat: 0, lng: -180},
          mapTypeId: google.maps.MapTypeId.TERRAIN
        });

        var flightPlanCoordinates = [
          {lat: 37.772, lng: -122.214},
          {lat: 21.291, lng: -157.821},
          {lat: -18.142, lng: 178.431},
          {lat: -27.467, lng: 153.027}
        ];
        var flightPath = new google.maps.Polyline({
          path: flightPlanCoordinates,
          geodesic: true,
          strokeColor: '#FF0000',
          strokeOpacity: 1.0,
          strokeWeight: 2
        });

        flightPath.setMap(map);
      }

});*/

</script>
 