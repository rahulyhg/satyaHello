 <?php $session=new Zend\Session\Container('user'); 
 $token_session	=	$session->offsetGet('token');
?>
<?php if($token_session==""){ ?>
 	<script>
	window.location='<?php echo $this->basePath();?>';
 	</script>
 	<?php 
 }?>
     <div class="container-fluid">
 	<div class="row">
	 	<div class="col-lg-12 col-lg-col-lg-offset-2 text-center headingbg">
			<h2>My Account</h2>
		</div>
	 </div>																												      
     <div class="container marginbottom20">
      	<div class="row">
			<div class="col-lg-12">
				<div class="col-sm-3 col-md-3 col-lg-2">					 
					 <div class="list-group">
            <a href="<?php echo $this->basepath(); ?>/login/driver" class="list-group-item"><i class="fa fa-arrow-circle-right"></i> &nbsp;Dashboard</a>
            <a href="<?php echo $this->basepath(); ?>/login/driver/drivereditprofile" class="list-group-item"><i class="fa fa-arrow-circle-right"></i> &nbsp;Edit Profile</a>
            <a href="<?php echo $this->basepath(); ?>/login/driver/changepassword" class="list-group-item"><i class="fa fa-arrow-circle-right"></i> &nbsp;Change Password</a>
            <a href="<?php echo $this->basepath(); ?>/login/driver/driverorderhistory" class="list-group-item yellactive"><i class="fa fa-arrow-circle-right"></i> &nbsp;Booking History</a>
            <!--<a href="<?php echo $this->basepath(); ?>/login/driver/accountbalance" class="list-group-item"><i class="fa fa-arrow-circle-right"></i> &nbsp;Account Balance</a>
			<a href="<?php echo $this->basepath(); ?>/login/driver/markupmanagement" class="list-group-item"><i class="fa fa-arrow-circle-right"></i> &nbsp;Markup Management</a>-->
			<a href="<?php echo $this->basepath(); ?>/login/driver/transaction" class="list-group-item"><i class="fa fa-arrow-circle-right"></i> &nbsp;Transaction</a>    
            <a href="<?php echo $this->basepath(); ?>/login/driver/creditrequest" class="list-group-item"><i class="fa fa-arrow-circle-right"></i> &nbsp;Credit Request</a>
            <a href="<?php echo $this->basepath(); ?>/login/driver/bankdetail" class="list-group-item"><i class="fa fa-arrow-circle-right"></i> &nbsp;Bank Details</a>       
			<a href="<?php echo $this->basepath(); ?>/login/driver/vehicleupdate" class="list-group-item"><i class="fa fa-arrow-circle-right"></i> &nbsp;Vehicle Details</a>
		 </div>
				</div>				
				<div class="col-sm-9 col-md-9 col-lg-10">
					<div class="row" style="display:block;">
                <div class="col-lg-12">
                    <div class="panel panel-default">
                        <div class="panel-heading tabheading text-center text-uppercase ">
                           <b style="display:;">Driver Booking History</b>						 
                        </div>						
						<div class="order_history" style="margin-top:10px;">
                        	
						<label class="col-sm-1">Booking ID</label>
                        
                        <div class="col-sm-2">
						<input type="text" class="text3 form-control" id="BookingID">
                        </div>
						<label  class="col-sm-1">Type of Transaction</label>
                         <div class="col-sm-1">
						<select class="text3 form-control" id="transaction_type">
						<option value="All">All</option>
						<option value="A">Accepted</option>
						<option value="M">Missed</option>
						<option value="C">Cancelled</option>
						<option value="R">Rejected</option>
						</select>
                        </div>
												
						<label class="col-sm-1">From Date</label>
                        <div class="col-sm-2">
						<input type="text" class="text3 form-control" id="from">
                        </div>
						<label class="col-sm-1">To Date</label>
						<div class="col-sm-2">
                        <input type="text" class="text3 form-control" id="to">	
                        </div>	
                        <div class="col-sm-1">				
                        <input type="button" class="submit" value="SUBMIT" id="orderHistory" onclick="fetch_order_history();">
                        </div>
						</div>						
                        <!-- /.panel-heading -->
                        <div class="panel-body">						
						<!-- Dashboard Start-->	
								<div class="col-sm-12 col-md-12" style="display:block;">									
									<div class="col-sm-4 col-sm-offset-2 paddinttop10">	
                        <!-- /.portlet -->                     
									</div>
									<div class="col-sm-4 paddinttop10">										
									</div>									
						<div class="row">						
									<div class="col-sm-4 paddinttop10">										
									</div>									
									<div class="col-sm-4 paddinttop10">									
									</div>									
									<div class="col-sm-4 paddinttop10">	
									</div>
						</div>
						<div class="row" id="show_order" style="display:;">
							<div class="portlet portlet-de" style="border:1px solid #d5d3d4;">			                         
			                            <div class=" " >
			                                <div class="table-responsive ">	
            <table id="driver" class="table table-striped" style="width: 100% !important;">
                <thead>
                    <tr>
                        <th style="">Serial Number</th>
						<th style="">Booking Date</th>
						<th style="">Booking Number</th>
						<th style="width:150px !important;">Booking Type</th>
						<th style="">Vehicle Category</th>
						<th style="">Client Name</th>
                        <th style="width:64px !important;">Pickup Time</th>
                        <!--<th style="">Booking Amount</th>-->
                        <th style="">Pickup Address</th>
						<th style="">Drop Address</th>                        
                        <th style="">Booking Status</th>
                    </tr>
                </thead>
				 <tbody>
                </tbody>
            </table>
			                                </div>
			                            </div>
						</div>
								</div>							
							<!-- /.table-responsive End-->                         
                        </div>
							<!-- Dashboard Start-->	
                        <!-- /.panel-body -->
                    </div>
                    <!-- /.panel -->
                </div>
                <!-- /.col-lg-12 -->
            </div>
				</div>
			</div>
       	</div>
	 </div>
  	</div>
	 </div>
<script>
function loginhome(){
	var base_url = "<?php echo $this->basePath(); ?>";
	//alert(base_url);
//window.open('http://50.62.22.158:8085/hello42test/public/login',"_self");
window.open(base_url+'/login',"_self");
}
function signuphome(){	
	window.open(base_url+'/login',"_self");	
}
</script>
<script type="text/javascript">
        $(document).ready(function() {
            //$('#jsCarousel').jsCarousel({ onthumbnailclick: function(src) { alert(src); }, autoscroll: true });
            $.fn.dataTableExt.sErrMode = 'throw';
            datatablsCSS();            
            $("#from").datepicker();
            $("#from").datepicker("option","dateFormat","yy-mm-dd");
            $("#to").datepicker();
            $("#to").datepicker("option","dateFormat","yy-mm-dd");            
        });        
        function fetch_order_history(){            
            $("#show_order").show();
			var BookingID = $("#BookingID").val();
            var tType = $("#transaction_type").val();
            var fromDate = $("#from").val();
            var toDate = $("#to").val();			
            var token = $.cookie('token');
			var login_id = $.cookie('login_id');
            var table;
            table=$('#driver').dataTable({
            "ajax": '<?php echo $this->basePath();?>/tunnel/menu/driverOrderHistory?BookingID='+BookingID+'&ids='+token+'&from='+fromDate+'&to='+toDate+'&type='+tType+'&Did='+login_id,
            "deferRender": true
            });  
            $("#driver_wrapper").attr("style","border:1px solid #d2d2d2;");
            $("#driver_wrapper").addClass("clearfix");
            $("#driver_wrapper + div").removeClass("row");
            $("#driver_info").parent().parent().removeClass("row");
            $("#driver_wrapper div:first").attr("class","tbsearchrow clearfix");
            $('#driver_filter label').attr("style","display:none;");
            $(".paginate_button").attr("style","z-index:999 !important;");
}
$('.text3').keypress(function(e){
	var key=e.which;
	if(key==13)
	{
		fetch_order_history();
	}
});
function datatablsCSS(){
	$(".paging_simple_numbers").parent().addClass('pgnt_topfix');
    $('.dataTables_length').parent().removeClass('col-sm-6');
    $('.dataTables_length').parent().addClass('col-sm-2');
    $('.dataTables_length').parent().addClass('pgno_top');
	$('.pgno_top').attr("style","top:37px;");
	$('.pgnt_topfix').attr("style","top:36px;");
}
var myVar2;
var myVar;
var myTimer2;
$(document).on('click','.clickme',function(){
        i=1;  
          clearInterval(myVar2);
          clearInterval(myVar);
          i=0;
      // alert("fdfdfdfdfdfd");
      if($(this).hasClass('open'))
      {
 myVar2=setInterval(function(){myTimer2()}, 30000);	  
          $(".remove div:first").slideUp(400,function(){
               $('.remove').remove();              
          });     
      $(this).removeClass('open');	  
  }else{	  
      $('.remove').remove();       
       $(this).addClass('open');       
      $(this).parent().parent().after('<tr class="remove" ><td colspan="13"><div style="display:none"> <div class=""> <!--<div class="portlet portlet-default"> <div class="portlet-heading"> <div class="portlet-title"></div>--> <div class="clearfix"></div> </div> <div class="portlet-body"> <ul id="myTab" class="nav nav-tabs tabsdesign"> <li class="active"><a href="#home1" data-toggle="tab"><i class="fa fa-list" style="color:#; margin:5px"></i>Status</a> </li> <li><a href="#bookinginfo" data-toggle="tab"><i class="fa fa-user" style="color:#; margin:5px"></i>Booking Details</a> </li><li><a href="#payment" data-toggle="tab"><i class="fa fa-user" style="color:#; margin:5px"></i> Payment Details</a> </li><li><a href="#way_point" data-toggle="tab"><i class="fa fa-user" style="color:#; margin:5px"></i>Way Points</a> </li></li></ul> <div id="myTabContent" class="tab-content contantboxoftabs"> <div class="tab-pane fade in active" id="home1"><h5 class="h4text" style="background: #E2E2E2;padding:7px;margin: 0;">Status</h5><table id="example2" class="table table-striped table-responsive"><thead> <tr> <th>Date</th> <th>State</th> <th>Text</th> </tr> </thead> <tbody> </tbody> </table></div><div class="tab-pane fade" id="payment"><h5 class="h4text" style="background: #E2E2E2;padding:7px;margin: 0;">Payment Details</h5><table id="paymentdetail" class="table table-responsive table-striped"></table></div><div class="tab-pane fade" id="bookinginfo"><h5 class="h4text" style="background: #E2E2E2;padding:7px;margin: 0;">Booking Information</h5><table id="bookinf" class="table table-responsive table-striped"></table></div><div id="driver_alloc" class="tab-pane fade"><h5 class="h4text" style="background: #E2E2E2;padding:7px;margin: 0;">Driver Allocation</h5><table id="driver_alloc_2" class="table table-striped table-responsive"><thead> <tr> <th>Driver</th> <th>Vehicle</th> <th>Created</th><th>Allocation Status</th> </tr> </thead> <tbody> </tbody> </table></div></div></td></tr>');
    data=$(this).attr("data");   
    $.ajax({
  url: '<?php echo $this->basePath();?>'+"/tunnel/admin/booking_information?booking_id="+data,
  cache: false,
  dataType:"json"
})
  .done(function( html ) {
	  $('#example2 tbody').html('');
    for(var i=0;i<html.data.length;i++)
{
                               $('#example2 tbody').append('<tr><td>'+html.data[i].time+'</td><td>'+html.data[i].status+'</td><td>'+html.data[i].message+'</td></tr>');  
  }
  });
  $.ajax({
  url: '<?php echo $this->basePath();?>'+"/tunnel/admin/payment_information?booking_id="+data,
  cache: false,
  dataType:"json"
})
  .done(function( html ) { 
                      $('#paymentdetail').append('<tr><th></th><th>Created At</th><td>'+html.data[0].created_at+'</td></tr><tr><th></th><th>Is Paid</th><td>'+html.data[0].is_paid+'</td></tr><tr><th></th><th>Paid At</th><td>'+html.data[0].paid_at+'</td></tr><tr><th>Price</th><th>Currency</th><td>'+html.data[0].currency+'</td></tr><tr><th></th><th>Invoice Number</th><td>'+html.data[0].invoice_number+'</td></tr><tr><th></th><th>External Refernece</th><td></td></tr><tr><th></th><th>Payment Type</th><td>'+html.data[0].payment_type+'</td></tr><tr><th></th><th>Fees</th><td>'+html.data[0].fees+'</td></tr><tr><th></th><th>Total Price </th><td>'+html.data[0].total_price+'</td></tr><tr><th></th><th>Total Tax Price</th><td>'+html.data[0].total_tax_price+'</td></tr><tr><th>Payment Parts</th><th>Company Base Index</th><td></td></tr><tr><th></th><th>Partner Index</th><td></td></tr><tr><th></th><th>Distance Rate</th><td>'+html.data[0].distance_rate+'</td></tr><tr><th></th><th>Duration Rate</th><td>'+html.data[0].duration_rate+'</td></tr><tr><th></th><th>Starting Rate</th><td>'+html.data[0].starting_rate+'</td></tr><tr><th></th><th>Base Price</th><td>'+html.data[0].minimum_price+'</td></tr><tr><th></th><th>Tax Price</th><td>'+html.data[0].tax_price+'</td></tr><tr><th></th><th>Fraction Discount</th><td></td></tr><tr><th></th><th>Voucher Amount</th><td></td></tr><tr><th></th><th>Price Type</th><td>Variable</td></tr><tr><th>Applied Tarrifs</th><th>Starting Rate</th><td>'+html.data[0].starting_charge+'</td></tr><tr><th></th><th>Distance Rate</th><td>'+html.data[0].distance_rate+'</td></tr><tr><th></th><th>Duration Rate</th><td>'+html.data[0].duration_charge+'</td></tr><tr><th></th><th>Minimum Price</th><td>'+html.data[0].minimum_price+'</td></tr><tr><th></th><th>Cancellation Price</th><td>'+html.data[0].cancellation_price+'</td></tr><tr><th></th><th>No Show Fee</th><td></td></tr><tr><th colspan="3">Credit Card Details</th></tr><tr><th>Personal</th><th>Internal Id</th><td></td></tr><tr><th></th><th>External Id</th><td></td></tr><tr><th></th><th>External Reference</th><td></td></tr><tr><th></th><th>Card Type</th><td></td></tr><tr><th></th><th>Card Number</th><td></td></tr><tr><th></th><th>Expired At</th><td></td></tr><tr><th></th><th>Card Owner</th><td></td></tr><tr><th></th><th>Created At</th><td></td></tr><tr><th></th><th>Verified Date</th><td></td></tr><tr><th></th><th>Active</th><td></td></tr><!--<tr><th>Waiting Charge</th><td>'+html.data[0].waiting+'</td></tr><tr><th>Trip Charge</th><td>'+html.data[0].tripCharge+'</td></tr><tr><th>Total Bill</th><td>'+html.data[0].totalbill+'</td></tr><tr><th>Staring Rate</th><td></td></tr><tr><th>Distance Rate</th><td></td></tr><tr><th>Duration Rate</th><td></td></tr><tr><th>Minimum Price</th><td></td></tr><tr><th></th><td></td></tr>-->');  
                       $('#bookinf').append('<tr><th>In</th><td>Booking Id</td><td>'+html.data[0].book_ref+'</td></tr><tr><th></th><th>UserAgent</th><td>'+html.data[0].useragent+'</td></tr><tr><th></th><th>Comments for the client</th><td></td></tr><tr><th></th><th>Comment For the driver</th><td></td></tr><tr><th></th><th>Drivers Note</th><td>'+html.data[0].driver_note+'</td></tr><tr><th></th><th>Clients Note</th><td>'+html.data[0].client_note+'</td></tr><tr><th></th><th>Features</th><td>'+html.data[0].features+'</td></tr><tr><th></th><th>Vehicle Type</th><td>'+html.data[0].cab_name+'</td></tr><tr><th></th><th>Is account booking</th><td>'+html.data[0].is_account_booking+'<td></td></tr><tr><th></th><th>Is Corporate Booking</th><td>'+html.data[0].is_corporate_booking+'</td></tr><tr><th></th><th>Is account booking</th><td>'+html.data[0].is_account_booking+'</td></tr><tr><th></th><th>Is credit card Available</th><td></td></tr><tr><th></th><th>Voucher Id</th><td>'+html.data[0].voucher_id+'</td></tr><tr><th></th><th>Voucher Type</th><td>'+html.data[0].voucher_type+'</td></tr><tr><th></th><th>Voucher Amount</th><td></td></tr><tr><th>Out</th><th>External Booking Reference</th><td>N/A</td></tr><tr><th></th><th>Arrival Time Pre</th><td>'+html.data[0].arrival_time_pre+'</td></tr><tr><th></th><th>Arrival Time Post</th><td>'+html.data[0].arrival_time_post+'</td></tr><tr><th></th><th>Arrival Time Actual</th><td>'+html.data[0].arrival_time_actual+'</td></tr><tr><th></th><th>Expiration Time</th><td>'+html.data[0].expiration_time+'</td></tr><tr><th></th><th>Actual Driving Duration</th><td>'+html.data[0].actual_driven_duration+'</td></tr><tr><th></th><th>Actual Waiting Distance</th><td>'+html.data[0].actual_waiting_distance+'</td></tr><tr><th></th><th>Actual Distance</th><td>'+html.data[0].actual_distance+'</td></tr><tr><th></th><th>Booking Type</th><td>'+html.data[0].bookingtype+'</td></tr><tr><th></th><th>Booking Date</th><td>'+html.data[0].bookingdate+'</td></tr><tr><th></th><th>Pickup Date</th><td>'+html.data[0].pickupdate+'</td></tr><tr><th></th><th>Pickup Area</th><td>'+html.data[0].pickuparea+'</td></tr><tr><th></th><th>Pickup Address</th><td>'+html.data[0].pickupaddress+'</td></tr><tr><th></th><th>Drop Address</th><td>'+html.data[0].dropaddress+'</td></tr><tr><th></th><th>Drop Area</th><td>'+html.data[0].droparea+'</td></tr><tr><th></th><th>Estimated Distance</th><td>'+html.data[0].estimated_distance+'</td></tr><tr><th></th><th>Estimated Time</th><td>'+html.data[0].estimated_time+'</td></tr><tr><th></th><th>Estimated Price</th><td>'+html.data[0].estimated_price+'</td></tr><tr><th>Driver Rating</th><th>Rating</th><td>'+html.data[0].driver_rating+'</td></tr><tr><th></th><th>Reason</th><td></td></tr><tr><th></th><th>Comment</th><td></td></tr><tr><th>Client Rating</th><th>Rating</th><td>'+html.data[0].client_rating+'</td></tr><tr><th></th><th>Reason</th><td></td></tr><tr><th></th><th>Comment</th><td></td></tr>');
					   $('#bookinginfo').append('<div class="col-sm-12 marginbottom20" style="margin-top: 25px;"><a href="#" class="btn btn-default marginright" id="export_booking_info"><i class="fa fa-download marginright"></i>Download CSV</a></div>');
  
  });
      myVar = setInterval(function(){myTimer()}, 30000);
      function myTimer(){        
     $.ajax({
  url: '<?php echo $this->basePath();?>'+"/tunnel/admin/booking_information?booking_id="+data,
  cache: false,
  dataType:"json"
})
  .done(function( html ) {
      $('#example2 tbody').html('');
    for(var i=0;i<html.data.length;i++)
{
                               $('#example2 tbody').append('<tr><td>'+html.data[i].time+'</td><td>'+html.data[i].status+'</td><td>'+html.data[i].message+'</td></tr>');  
  }
  });    
	$.ajax({
		url: '<?php echo $this->basePath();?>'+"/tunnel/admin/driver_alloc?booking_id="+data,
		cache: false,
		dataType:"json"
	})
	.done(function( html ) {
    $('#driver_alloc_2 tbody').html('');
		for(var i=0;i<html.data.length;i++)
		{
			$('#driver_alloc_2').append('<tr><td>'+html.data[i].driver_name+'</td><td>'+html.data[i].vehicle+'</td><td>'+html.data[i].created+'</td><td>'+html.data[i].status+'</td></tr>');  
		}
	});
    }
   $(".remove div:first").slideDown(400,function(){
       //e.preventDefault();
    }
    );
  }
    });
</script>
    
<style>
		.col-sm-2 {
    color: #333 !important;
	padding-right:0 !important;
}

.col-sm-1 {
    color: #333 !important;
	padding-right:0 !important;
	
}

</style>